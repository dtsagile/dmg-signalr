(function(c){var d={VERSION:"0.3",ROOT_URL:function(){for(var h=document.getElementsByTagName("script"),j=/^(.*\/)leaflet-?([\w-]*)\.js.*$/,k=0,l=h.length;k<l;k++){var m=h[k].src;if(m=m&&m.match(j)){if(m[2]=="include"){break}return m[1]}}return"../../dist/"}(),noConflict:function(){c.L=this._originalL;return this},_originalL:c.L};window.L=d})(this);L.Util={extend:function(g){for(var h=Array.prototype.slice.call(arguments,1),j=0,k=h.length,l;j<k;j++){l=h[j]||{};for(var m in l){l.hasOwnProperty(m)&&(g[m]=l[m])}}return g},bind:function(c,d){return function(){return c.apply(d,arguments)}},stamp:function(){var b=0;return function(a){a._leaflet_id=a._leaflet_id||++b;return a._leaflet_id}}(),requestAnimFrame:function(){function c(b){window.setTimeout(b,1000/60)}var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||c;return function(a,b,f){a=b?L.Util.bind(a,b):b;f&&d===c?a():d(a)}}(),limitExecByInterval:function(h,j,k){function l(){m=!1;n&&(o.callee.apply(k,o),n=!1)}var m,n,o;return function(){o=arguments;m?n=!0:(m=!0,setTimeout(l,j),h.apply(k,o))}},falseFn:function(){return !1},formatNum:function(d,e){var f=Math.pow(10,e||5);return Math.round(d*f)/f},setOptions:function(c,d){c.options=L.Util.extend({},c.options,d)},getParamString:function(d){var e=[],f;for(f in d){d.hasOwnProperty(f)&&e.push(f+"="+d[f])}return"?"+e.join("&")}};L.Class=function(){};L.Class.extend=function(e){var f=function(){this.initialize&&this.initialize.apply(this,arguments)},g=function(){};g.prototype=this.prototype;g=new g;g.constructor=f;f.prototype=g;f.superclass=this.prototype;for(var h in this){this.hasOwnProperty(h)&&h!="prototype"&&h!="superclass"&&(f[h]=this[h])}e.statics&&(L.Util.extend(f,e.statics),delete e.statics);e.includes&&(L.Util.extend.apply(null,[g].concat(e.includes)),delete e.includes);if(e.options&&g.options){e.options=L.Util.extend({},g.options,e.options)}L.Util.extend(g,e);f.extend=arguments.callee;f.include=function(b){L.Util.extend(this.prototype,b)};return f};L.Mixin={};L.Mixin.Events={addEventListener:function(e,f,g){var h=this._leaflet_events=this._leaflet_events||{};h[e]=h[e]||[];h[e].push({action:f,context:g});return this},hasEventListeners:function(b){return"_leaflet_events" in this&&b in this._leaflet_events&&this._leaflet_events[b].length>0},removeEventListener:function(g,h,j){if(!this.hasEventListeners(g)){return this}for(var k=0,l=this._leaflet_events,m=l[g].length;k<m;k++){if(l[g][k].action===h&&(!j||l[g][k].context===j)){l[g].splice(k,1);break}}return this},fireEvent:function(g,h){if(this.hasEventListeners(g)){for(var j=L.Util.extend({type:g,target:this},h),k=this._leaflet_events[g].slice(),l=0,m=k.length;l<m;l++){k[l].action.call(k[l].context||this,j)}return this}}};L.Mixin.Events.on=L.Mixin.Events.addEventListener;L.Mixin.Events.off=L.Mixin.Events.removeEventListener;L.Mixin.Events.fire=L.Mixin.Events.fireEvent;(function(){var g=navigator.userAgent.toLowerCase(),h=!!window.ActiveXObject,j=g.indexOf("webkit")!=-1,k=typeof orientation!="undefined"?!0:!1,l=g.indexOf("android")!=-1,m=window.opera;L.Browser={ie:h,ie6:h&&!window.XMLHttpRequest,webkit:j,webkit3d:j&&"WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix,gecko:g.indexOf("gecko")!=-1,opera:m,android:l,mobileWebkit:k&&j,mobileOpera:k&&m,mobile:k,touch:"ontouchstart" in document.documentElement}})();L.Point=function(d,e,f){this.x=f?Math.round(d):d;this.y=f?Math.round(e):e};L.Point.prototype={add:function(b){return this.clone()._add(b)},_add:function(b){this.x+=b.x;this.y+=b.y;return this},subtract:function(b){return this.clone()._subtract(b)},_subtract:function(b){this.x-=b.x;this.y-=b.y;return this},divideBy:function(c,d){return new L.Point(this.x/c,this.y/c,d)},multiplyBy:function(b){return new L.Point(this.x*b,this.y*b)},distanceTo:function(c){var d=c.x-this.x,c=c.y-this.y;return Math.sqrt(d*d+c*c)},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},clone:function(){return new L.Point(this.x,this.y)},toString:function(){return"Point("+L.Util.formatNum(this.x)+", "+L.Util.formatNum(this.y)+")"}};L.Bounds=L.Class.extend({initialize:function(f,g){if(f){for(var h=f instanceof Array?f:[f,g],j=0,k=h.length;j<k;j++){this.extend(h[j])}}},extend:function(b){!this.min&&!this.max?(this.min=new L.Point(b.x,b.y),this.max=new L.Point(b.x,b.y)):(this.min.x=Math.min(b.x,this.min.x),this.max.x=Math.max(b.x,this.max.x),this.min.y=Math.min(b.y,this.min.y),this.max.y=Math.max(b.y,this.max.y))},getCenter:function(b){return new L.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,b)},contains:function(c){var d;c instanceof L.Bounds?(d=c.min,c=c.max):d=c;return d.x>=this.min.x&&c.x<=this.max.x&&d.y>=this.min.y&&c.y<=this.max.y}});L.Transformation=L.Class.extend({initialize:function(e,f,g,h){this._a=e;this._b=f;this._c=g;this._d=h},transform:function(c,d){return this._transform(c.clone(),d)},_transform:function(c,d){d=d||1;c.x=d*(this._a*c.x+this._b);c.y=d*(this._c*c.y+this._d);return c},untransform:function(c,d){d=d||1;return new L.Point((c.x/d-this._b)/this._a,(c.y/d-this._d)/this._c)}});L.LineUtil={simplify:function(c,d){if(!d||!c.length){return c.slice()}c=this.reducePoints(c,d);return c=this.simplifyDP(c,d)},pointToSegmentDistance:function(d,e,f){return Math.sqrt(this._sqPointToSegmentDist(d,e,f))},closestPointOnSegment:function(d,e,f){d=this._sqClosestPointOnSegment(d,e,f);d.distance=Math.sqrt(d._sqDist);return d},simplifyDP:function(h,k){for(var l=0,m=0,n=k*k,o=1,p=h.length,q;o<p-1;o++){q=this._sqPointToSegmentDist(h[o],h[0],h[p-1]),q>l&&(m=o,l=q)}return l>=n?(l=h.slice(0,m),m=h.slice(m),p=this.simplifyDP(l,k).slice(0,p-2),m=this.simplifyDP(m,k),p.concat(m)):[h[0],h[p-1]]},reducePoints:function(h,j){for(var k=[h[0]],l=j*j,m=1,n=0,o=h.length;m<o;m++){this._sqDist(h[m],h[n])<l||(k.push(h[m]),n=m)}n<o-1&&k.push(h[o-1]);return k},clipSegment:function(h,k,l,m){var m=m?this._lastCode:this._getBitCode(h,l),n=this._getBitCode(k,l);for(this._lastCode=n;;){if(m|n){if(m&n){return !1}else{var o=m||n,p=this._getEdgeIntersection(h,k,o,l),q=this._getBitCode(p,l);o==m?(h=p,m=q):(k=p,n=q)}}else{return[h,k]}}},_getEdgeIntersection:function(g,h,j,k){var l=h.x-g.x,h=h.y-g.y,m=k.min,k=k.max;if(j&8){return new L.Point(g.x+l*(k.y-g.y)/h,k.y)}else{if(j&4){return new L.Point(g.x+l*(m.y-g.y)/h,m.y)}else{if(j&2){return new L.Point(k.x,g.y+h*(k.x-g.x)/l)}else{if(j&1){return new L.Point(m.x,g.y+h*(m.x-g.x)/l)}}}}},_getBitCode:function(d,e){var f=0;d.x<e.min.x?f|=1:d.x>e.max.x&&(f|=2);d.y<e.min.y?f|=4:d.y>e.max.y&&(f|=8);return f},_sqDist:function(e,f){var g=f.x-e.x,h=f.y-e.y;return g*g+h*h},_sqClosestPointOnSegment:function(h,j,k){var l=k.x-j.x,m=k.y-j.y,n=j;if(l||m){var o=((h.x-j.x)*l+(h.y-j.y)*m)/this._sqDist(j,k);o>1?n=k:o>0&&(n=new L.Point(j.x+l*o,j.y+m*o))}n._sqDist=this._sqDist(h,n);return n},_sqPointToSegmentDist:function(d,e,f){return this._sqClosestPointOnSegment(d,e,f)._sqDist}};L.PolyUtil={};L.PolyUtil.clipPolygon=function(m,n){var o,p=[1,4,2,8],q,r,s,u,t,v,w=L.LineUtil;q=0;for(t=m.length;q<t;q++){m[q]._code=w._getBitCode(m[q],n)}for(s=0;s<4;s++){v=p[s];o=[];q=0;t=m.length;for(r=t-1;q<t;r=q++){if(u=m[q],r=m[r],u._code&v){if(!(r._code&v)){r=w._getEdgeIntersection(r,u,v,n),r._code=w._getBitCode(r,n),o.push(r)}}else{if(r._code&v){r=w._getEdgeIntersection(r,u,v,n),r._code=w._getBitCode(r,n),o.push(r)}o.push(u)}}m=o}return m};L.DomEvent={addListener:function(h,j,k,l){function m(a){return k.call(l||h,a||L.DomEvent._getEvent())}var n=L.Util.stamp(k);if(L.Browser.touch&&j=="dblclick"&&this.addDoubleTapListener){this.addDoubleTapListener(h,m,n)}else{if("addEventListener" in h){if(j=="mousewheel"){h.addEventListener("DOMMouseScroll",m,!1),h.addEventListener(j,m,!1)}else{if(j=="mouseenter"||j=="mouseleave"){var o=m,m=function(a){if(L.DomEvent._checkMouse(h,a)){return o(a)}};h.addEventListener(j=="mouseenter"?"mouseover":"mouseout",m,!1)}else{h.addEventListener(j,m,!1)}}}else{"attachEvent" in h&&h.attachEvent("on"+j,m)}}h["_leaflet_"+j+n]=m},removeListener:function(e,f,g){var g=L.Util.stamp(g),h="_leaflet_"+f+g;handler=e[h];L.Browser.touch&&f=="dblclick"&&this.removeDoubleTapListener?this.removeDoubleTapListener(e,g):"removeEventListener" in e?f=="mousewheel"?(e.removeEventListener("DOMMouseScroll",handler,!1),e.removeEventListener(f,handler,!1)):f=="mouseenter"||f=="mouseleave"?e.removeEventListener(f=="mouseenter"?"mouseover":"mouseout",handler,!1):e.removeEventListener(f,handler,!1):"detachEvent" in e&&e.detachEvent("on"+f,handler);e[h]=null},_checkMouse:function(e,f){var g=f.relatedTarget;if(!g){return !0}try{for(;g&&g!=e;){g=g.parentNode}}catch(h){return !1}return g!=e},_getEvent:function(){var c=window.event;if(!c){for(var d=arguments.callee.caller;d;){if((c=d.arguments[0])&&Event==c.constructor){break}d=d.caller}}return c},stopPropagation:function(b){b.stopPropagation?b.stopPropagation():b.cancelBubble=!0},disableClickPropagation:function(b){L.DomEvent.addListener(b,"mousedown",L.DomEvent.stopPropagation);L.DomEvent.addListener(b,"click",L.DomEvent.stopPropagation);L.DomEvent.addListener(b,"dblclick",L.DomEvent.stopPropagation)},preventDefault:function(b){b.preventDefault?b.preventDefault():b.returnValue=!1},stop:function(b){L.DomEvent.preventDefault(b);L.DomEvent.stopPropagation(b)},getMousePosition:function(d,e){var f=new L.Point(d.pageX?d.pageX:d.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d.pageY?d.pageY:d.clientY+document.body.scrollTop+document.documentElement.scrollTop);return e?f.subtract(L.DomUtil.getViewportOffset(e)):f},getWheelDelta:function(c){var d=0;c.wheelDelta&&(d=c.wheelDelta/120);c.detail&&(d=-c.detail/3);return d}};L.Util.extend(L.DomEvent,{addDoubleTapListener:function(k,l,m){function n(d){if(d.touches.length==1){var e=Date.now(),f=e-(p||e);r=d.touches[0];q=f>0&&f<=s;p=e}}function o(){if(q){r.type="dblclick",l(r),p=null}}var p,q=!1,s=250,r;k["_leaflet_touchstart"+m]=n;k["_leaflet_touchend"+m]=o;k.addEventListener("touchstart",n,!1);k.addEventListener("touchend",o,!1)},removeDoubleTapListener:function(c,d){c.removeEventListener(c,c["_leaflet_touchstart"+d],!1);c.removeEventListener(c,c["_leaflet_touchend"+d],!1)}});L.DomUtil={get:function(b){return typeof b=="string"?document.getElementById(b):b},getStyle:function(d,e){var f=d.style[e];!f&&d.currentStyle&&(f=d.currentStyle[e]);if(!f||f=="auto"){f=(f=document.defaultView.getComputedStyle(d,null))?f[e]:null}return f=="auto"?null:f},getViewportOffset:function(f){var g=0,h=0,j=f,k=document.body;do{if(j===k){break}g+=j.offsetTop||0;h+=j.offsetLeft||0;if(L.DomUtil.getStyle(j,"position")=="absolute"){break}}while(j=j.offsetParent);j=f;do{if(j===k){break}g-=j.scrollTop||0;h-=j.scrollLeft||0}while(j=j.parentNode);return new L.Point(h,g)},create:function(d,e,f){d=document.createElement(d);d.className=e;f&&f.appendChild(d);return d},disableTextSelection:function(){document.selection&&document.selection.empty&&document.selection.empty();if(!this._onselectstart){this._onselectstart=document.onselectstart,document.onselectstart=L.Util.falseFn}},enableTextSelection:function(){document.onselectstart=this._onselectstart;this._onselectstart=null},CLASS_RE:/(\\s|^)'+cls+'(\\s|$)/,hasClass:function(c,d){return c.className.length>0&&RegExp("(^|\\s)"+d+"(\\s|$)").test(c.className)},addClass:function(c,d){L.DomUtil.hasClass(c,d)||(c.className+=(c.className?" ":"")+d)},removeClass:function(c,d){c.className=c.className.replace(/(\S+)\s*/g,function(b,e){if(e==d){return""}return b}).replace(/^\s+/,"")},setOpacity:function(c,d){L.Browser.ie?c.style.filter="alpha(opacity="+Math.round(d*100)+")":c.style.opacity=d},testProp:function(d){for(var e=document.documentElement.style,f=0;f<d.length;f++){if(d[f] in e){return d[f]}}return !1},getTranslateString:function(b){return L.DomUtil.TRANSLATE_OPEN+b.x+"px,"+b.y+"px"+L.DomUtil.TRANSLATE_CLOSE},getScaleString:function(c,d){return L.DomUtil.getTranslateString(d)+" scale("+c+") "+L.DomUtil.getTranslateString(d.multiplyBy(-1))},setPosition:function(c,d){c._leaflet_pos=d;L.Browser.webkit?c.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(d):(c.style.left=d.x+"px",c.style.top=d.y+"px")},getPosition:function(b){return b._leaflet_pos}};L.Util.extend(L.DomUtil,{TRANSITION:L.DomUtil.testProp(["transition","webkitTransition","OTransition","MozTransition","msTransition"]),TRANSFORM:L.DomUtil.testProp(["transformProperty","WebkitTransform","OTransform","MozTransform","msTransform"]),TRANSLATE_OPEN:"translate"+(L.Browser.webkit3d?"3d(":"("),TRANSLATE_CLOSE:L.Browser.webkit3d?",0)":")"});L.Draggable=L.Class.extend({includes:L.Mixin.Events,statics:{START:L.Browser.touch?"touchstart":"mousedown",END:L.Browser.touch?"touchend":"mouseup",MOVE:L.Browser.touch?"touchmove":"mousemove",TAP_TOLERANCE:15},initialize:function(c,d){this._element=c;this._dragStartTarget=d||c},enable:function(){if(!this._enabled){L.DomEvent.addListener(this._dragStartTarget,L.Draggable.START,this._onDown,this),this._enabled=!0}},disable:function(){if(this._enabled){L.DomEvent.removeListener(this._dragStartTarget,L.Draggable.START,this._onDown),this._enabled=!1}},_onDown:function(c){if(!(c.shiftKey||c.which!=1&&c.button!=1&&!c.touches)&&!(c.touches&&c.touches.length>1)){var d=c.touches&&c.touches.length==1?c.touches[0]:c;L.DomEvent.preventDefault(c);L.Browser.touch&&(d.target.className+=" leaflet-active");this._moved=!1;L.DomUtil.disableTextSelection();this._setMovingCursor();this._startPos=this._newPos=L.DomUtil.getPosition(this._element);this._startPoint=new L.Point(d.clientX,d.clientY);L.DomEvent.addListener(document,L.Draggable.MOVE,this._onMove,this);L.DomEvent.addListener(document,L.Draggable.END,this._onUp,this)}},_onMove:function(b){if(!(b.touches&&b.touches.length>1)){L.DomEvent.preventDefault(b);b=b.touches&&b.touches.length==1?b.touches[0]:b;if(!this._moved){this.fire("dragstart"),this._moved=!0}this._newPos=this._startPos.add(new L.Point(b.clientX,b.clientY)).subtract(this._startPoint);L.Util.requestAnimFrame(this._updatePosition,this,!0)}},_updatePosition:function(){L.DomUtil.setPosition(this._element,this._newPos);this.fire("drag")},_onUp:function(d){if(d.changedTouches){var d=d.changedTouches[0],e=d.target,f=this._newPos&&this._newPos.distanceTo(this._startPos)||0;e.className=e.className.replace(" leaflet-active","");f<L.Draggable.TAP_TOLERANCE&&this._simulateEvent("click",d)}L.DomUtil.enableTextSelection();this._restoreCursor();L.DomEvent.removeListener(document,L.Draggable.MOVE,this._onMove);L.DomEvent.removeListener(document,L.Draggable.END,this._onUp);this._moved&&this.fire("dragend")},_removeActiveClass:function(){},_setMovingCursor:function(){this._bodyCursor=document.body.style.cursor;document.body.style.cursor="move"},_restoreCursor:function(){document.body.style.cursor=this._bodyCursor},_simulateEvent:function(d,e){var f=document.createEvent("MouseEvent");f.initMouseEvent(d,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null);e.target.dispatchEvent(f)}});L.Transition=L.Class.extend({includes:L.Mixin.Events,statics:{CUSTOM_PROPS_SETTERS:{position:L.DomUtil.setPosition},implemented:function(){return L.Transition.NATIVE||L.Transition.TIMER}},options:{easing:"ease",duration:0.5},_setProperty:function(d,e){var f=L.Transition.CUSTOM_PROPS_SETTERS;if(d in f){f[d](this._el,e)}else{this._el.style[d]=e}}});L.Transition=L.Transition.extend({statics:function(){var b=L.DomUtil.TRANSITION;return{NATIVE:!!b,TRANSITION:b,PROPERTY:b+"Property",DURATION:b+"Duration",EASING:b+"TimingFunction",END:b=="webkitTransition"||b=="OTransition"?b+"End":"transitionend",CUSTOM_PROPS_PROPERTIES:{position:L.Browser.webkit?L.DomUtil.TRANSFORM:"top, left"}}}(),options:{fakeStepInterval:100},initialize:function(c,d){this._el=c;L.Util.setOptions(this,d);L.DomEvent.addListener(c,L.Transition.END,this._onTransitionEnd,this);this._onFakeStep=L.Util.bind(this._onFakeStep,this)},run:function(e){var f,g=[],h=L.Transition.CUSTOM_PROPS_PROPERTIES;for(f in e){e.hasOwnProperty(f)&&(f=h[f]?h[f]:f,f=f.replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()}),g.push(f))}this._el.style[L.Transition.DURATION]=this.options.duration+"s";this._el.style[L.Transition.EASING]=this.options.easing;this._el.style[L.Transition.PROPERTY]=g.join(", ");for(f in e){e.hasOwnProperty(f)&&this._setProperty(f,e[f])}this._inProgress=!0;this.fire("start");L.Transition.NATIVE?this._timer=setInterval(this._onFakeStep,this.options.fakeStepInterval):this._onTransitionEnd()},_onFakeStep:function(){this.fire("step")},_onTransitionEnd:function(){if(this._inProgress){this._inProgress=!1,clearInterval(this._timer),this._el.style[L.Transition.PROPERTY]="none",this.fire("step"),this.fire("end")}}});L.Transition=L.Transition.NATIVE?L.Transition:L.Transition.extend({statics:{getTime:Date.now||function(){return +new Date},TIMER:!0,EASINGS:{ease:[0.25,0.1,0.25,1],linear:[0,0,1,1],"ease-in":[0.42,0,1,1],"ease-out":[0,0,0.58,1],"ease-in-out":[0.42,0,0.58,1]},CUSTOM_PROPS_GETTERS:{position:L.DomUtil.getPosition},UNIT_RE:/^[\d\.]+(\D*)$/},options:{fps:50},initialize:function(d,e){this._el=d;L.Util.extend(this.options,e);var f=L.Transition.EASINGS[this.options.easing]||L.Transition.EASINGS.ease;this._p1=new L.Point(0,0);this._p2=new L.Point(f[0],f[1]);this._p3=new L.Point(f[2],f[3]);this._p4=new L.Point(1,1);this._step=L.Util.bind(this._step,this);this._interval=Math.round(1000/this.options.fps)},run:function(g){this._props={};var h=L.Transition.CUSTOM_PROPS_GETTERS,j=L.Transition.UNIT_RE;this.fire("start");for(var k in g){if(g.hasOwnProperty(k)){var l={};if(k in h){l.from=h[k](this._el)}else{var m=this._el.style[k].match(j);l.from=parseFloat(m[0]);l.unit=m[1]}l.to=g[k];this._props[k]=l}}clearInterval(this._timer);this._timer=setInterval(this._step,this._interval);this._startTime=L.Transition.getTime()},_step:function(){var c=L.Transition.getTime()-this._startTime,d=this.options.duration*1000;c<d?this._runFrame(this._cubicBezier(c/d)):(this._runFrame(1),this._complete())},_runFrame:function(e){var f=L.Transition.CUSTOM_PROPS_SETTERS,g,h;for(g in this._props){this._props.hasOwnProperty(g)&&(h=this._props[g],g in f?(h=h.to.subtract(h.from).multiplyBy(e).add(h.from),f[g](this._el,h)):this._el.style[g]=(h.to-h.from)*e+h.from+h.unit)}this.fire("step")},_complete:function(){clearInterval(this._timer);this.fire("end")},_cubicBezier:function(e){var f=3*Math.pow(1-e,2)*e,g=3*(1-e)*Math.pow(e,2),h=Math.pow(e,3),e=this._p1.multiplyBy(Math.pow(1-e,3)),f=this._p2.multiplyBy(f),g=this._p3.multiplyBy(g),h=this._p4.multiplyBy(h);return e.add(f).add(g).add(h).y}});L.LatLng=function(f,g,h){var j=parseFloat(f),k=parseFloat(g);if(isNaN(j)||isNaN(k)){throw Error("Invalid LatLng object: ("+f+", "+g+")")}h!==!0&&(j=Math.max(Math.min(j,90),-90),k=(k+180)%360+(k<-180?180:-180));this.lat=j;this.lng=k};L.Util.extend(L.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-09});L.LatLng.prototype={equals:function(b){if(!(b instanceof L.LatLng)){return !1}return Math.max(Math.abs(this.lat-b.lat),Math.abs(this.lng-b.lng))<=L.LatLng.MAX_MARGIN},toString:function(){return"LatLng("+L.Util.formatNum(this.lat)+", "+L.Util.formatNum(this.lng)+")"}};L.LatLngBounds=L.Class.extend({initialize:function(f,g){if(f){for(var h=f instanceof Array?f:[f,g],j=0,k=h.length;j<k;j++){this.extend(h[j])}}},extend:function(b){!this._southWest&&!this._northEast?(this._southWest=new L.LatLng(b.lat,b.lng),this._northEast=new L.LatLng(b.lat,b.lng)):(this._southWest.lat=Math.min(b.lat,this._southWest.lat),this._southWest.lng=Math.min(b.lng,this._southWest.lng),this._northEast.lat=Math.max(b.lat,this._northEast.lat),this._northEast.lng=Math.max(b.lng,this._northEast.lng))},getCenter:function(){return new L.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new L.LatLng(this._northEast.lat,this._southWest.lng)},getSouthEast:function(){return new L.LatLng(this._southWest.lat,this._northEast.lng)},contains:function(e){var f=this._southWest,g=this._northEast,h;e instanceof L.LatLngBounds?(h=e.getSouthWest(),e=e.getNorthEast()):h=e;return h.lat>=f.lat&&e.lat<=g.lat&&h.lng>=f.lng&&e.lng<=g.lng}});L.Projection={};L.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(e){var f=L.LatLng.DEG_TO_RAD,g=this.MAX_LATITUDE,h=e.lng*f,e=Math.max(Math.min(g,e.lat),-g)*f,e=Math.log(Math.tan(Math.PI/4+e/2));return new L.Point(h,e)},unproject:function(d,e){var f=L.LatLng.RAD_TO_DEG;return new L.LatLng((2*Math.atan(Math.exp(d.y))-Math.PI/2)*f,d.x*f,e)}};L.Projection.LonLat={project:function(b){return new L.Point(b.lng,b.lat)},unproject:function(c,d){return new L.LatLng(c.y,c.x,d)}};L.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.3142,R_MAJOR:6378137,project:function(f){var g=L.LatLng.DEG_TO_RAD,h=this.MAX_LATITUDE,j=this.R_MAJOR,k=f.lng*g*j,f=Math.max(Math.min(h,f.lat),-h)*g,g=this.R_MINOR/j,g=Math.sqrt(1-g*g),h=g*Math.sin(f),h=Math.pow((1-h)/(1+h),g*0.5),f=-j*Math.log(Math.tan(0.5*(Math.PI*0.5-f))/h);return new L.Point(k,f)},unproject:function(k,l){for(var m=L.LatLng.RAD_TO_DEG,n=this.R_MAJOR,o=k.x*m/n,p=this.R_MINOR/n,p=Math.sqrt(1-p*p),n=Math.exp(-k.y/n),q=Math.PI/2-2*Math.atan(n),s=15,r=0.1;Math.abs(r)>1e-07&&--s>0;){r=p*Math.sin(q),r=Math.PI/2-2*Math.atan(n*Math.pow((1-r)/(1+r),0.5*p))-q,q+=r}return new L.LatLng(q*m,o,l)}};L.CRS={latLngToPoint:function(c,d){return this.transformation._transform(this.projection.project(c),d)},pointToLatLng:function(d,e,f){return this.projection.unproject(this.transformation.untransform(d,e),f)},project:function(b){return this.projection.project(b)}};L.CRS.EPSG3857=L.Util.extend({},L.CRS,{code:"EPSG:3857",projection:L.Projection.SphericalMercator,transformation:new L.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(b){return this.projection.project(b).multiplyBy(6378137)}});L.CRS.EPSG900913=L.Util.extend({},L.CRS.EPSG3857,{code:"EPSG:900913"});L.CRS.EPSG4326=L.Util.extend({},L.CRS,{code:"EPSG:4326",projection:L.Projection.LonLat,transformation:new L.Transformation(1/360,0.5,-1/360,0.5)});L.CRS.EPSG3395=L.Util.extend({},L.CRS,{code:"EPSG:3395",projection:L.Projection.Mercator,transformation:function(){var b=L.Projection.Mercator;return new L.Transformation(0.5/(Math.PI*b.R_MAJOR),0.5,-0.5/(Math.PI*b.R_MINOR),0.5)}()});L.LayerGroup=L.Class.extend({initialize:function(d){this._layers={};if(d){for(var e=0,f=d.length;e<f;e++){this.addLayer(d[e])}}},addLayer:function(b){this._layers[L.Util.stamp(b)]=b;this._map&&this._map.addLayer(b);return this},removeLayer:function(b){delete this._layers[L.Util.stamp(b)];this._map&&this._map.removeLayer(b);return this},clearLayers:function(){this._iterateLayers(this.removeLayer,this);return this},onAdd:function(b){this._map=b;this._iterateLayers(b.addLayer,b)},onRemove:function(b){this._iterateLayers(b.removeLayer,b);delete this._map},_iterateLayers:function(d,e){for(var f in this._layers){this._layers.hasOwnProperty(f)&&d.call(e,this._layers[f])}}});L.FeatureGroup=L.LayerGroup.extend({includes:L.Mixin.Events,addLayer:function(b){this._initEvents(b);L.LayerGroup.prototype.addLayer.call(this,b);this._popupContent&&b.bindPopup&&b.bindPopup(this._popupContent)},bindPopup:function(c){this._popupContent=c;for(var d in this._layers){this._layers.hasOwnProperty(d)&&this._layers[d].bindPopup&&this._layers[d].bindPopup(c)}},_events:["click","dblclick","mouseover","mouseout"],_initEvents:function(d){for(var e=0,f=this._events.length;e<f;e++){d.on(this._events[e],this._propagateEvent,this)}},_propagateEvent:function(b){b.layer=b.target;b.target=this;this.fire(b.type,b)}});L.TileLayer=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,scheme:"xyz",noWrap:!1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile},initialize:function(c,d){L.Util.setOptions(this,d);this._url=c;if(typeof this.options.subdomains=="string"){this.options.subdomains=this.options.subdomains.split("")}},onAdd:function(c,d){this._map=c;this._insertAtTheBottom=d;this._initContainer();this._createTileProto();c.on("viewreset",this._reset,this);if(this.options.updateWhenIdle){c.on("moveend",this._update,this)}else{this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),c.on("move",this._limitedUpdate,this)}this._reset();this._update()},onRemove:function(){this._map.getPanes().tilePane.removeChild(this._container);this._container=null;this._map.off("viewreset",this._reset,this);this.options.updateWhenIdle?this._map.off("moveend",this._update,this):this._map.off("move",this._limitedUpdate,this)},getAttribution:function(){return this.options.attribution},setOpacity:function(b){this.options.opacity=b;this._setOpacity(b);if(L.Browser.webkit){for(i in this._tiles){this._tiles[i].style.webkitTransform+=" translate(0,0)"}}},_setOpacity:function(b){b<1&&L.DomUtil.setOpacity(this._container,b)},_initContainer:function(){var c=this._map.getPanes().tilePane,d=c.firstChild;if(!this._container||c.empty){this._container=L.DomUtil.create("div","leaflet-layer"),this._insertAtTheBottom&&d?c.insertBefore(this._container,d):c.appendChild(this._container),this._setOpacity(this.options.opacity)}},_reset:function(){this._tiles={};this._initContainer();this._container.innerHTML=""},_update:function(){var d=this._map.getPixelBounds(),e=this.options.tileSize,f=new L.Point(Math.floor(d.min.x/e),Math.floor(d.min.y/e)),d=new L.Point(Math.floor(d.max.x/e),Math.floor(d.max.y/e)),f=new L.Bounds(f,d);this._addTilesFromCenterOut(f);this.options.unloadInvisibleTiles&&this._removeOtherTiles(f)},_addTilesFromCenterOut:function(f){for(var g=[],h=f.getCenter(),j=f.min.y;j<=f.max.y;j++){for(var k=f.min.x;k<=f.max.x;k++){k+":"+j in this._tiles||g.push(new L.Point(k,j))}}g.sort(function(c,d){return c.distanceTo(h)-d.distanceTo(h)});f=document.createDocumentFragment();this._tilesToLoad=g.length;j=0;for(k=this._tilesToLoad;j<k;j++){this._addTile(g[j],f)}this._container.appendChild(f)},_removeOtherTiles:function(e){var f,g,h;for(h in this._tiles){if(this._tiles.hasOwnProperty(h)&&(f=h.split(":"),g=parseInt(f[0],10),f=parseInt(f[1],10),g<e.min.x||g>e.max.x||f<e.min.y||f>e.max.y)){this._tiles[h].parentNode==this._container&&this._container.removeChild(this._tiles[h]),delete this._tiles[h]}}},_addTile:function(h,j){var k=this._getTilePos(h),l=this._map.getZoom(),m=h.x+":"+h.y,n=1<<l;if(!this.options.noWrap){h.x=(h.x%n+n)%n}if(!(h.y<0||h.y>=n)){var o=this._createTile();L.DomUtil.setPosition(o,k);this._tiles[m]=o;if(this.options.scheme=="tms"){h.y=n-h.y-1}this._loadTile(o,h,l);j.appendChild(o)}},_getTilePos:function(c){var d=this._map.getPixelOrigin();return c.multiplyBy(this.options.tileSize).subtract(d)},getTileUrl:function(c,d){return this._url.replace("{s}",this.options.subdomains[(c.x+c.y)%this.options.subdomains.length]).replace("{z}",d).replace("{x}",c.x).replace("{y}",c.y)},_createTileProto:function(){this._tileImg=L.DomUtil.create("img","leaflet-tile");this._tileImg.galleryimg="no";var b=this.options.tileSize;this._tileImg.style.width=b+"px";this._tileImg.style.height=b+"px"},_createTile:function(){var b=this._tileImg.cloneNode(!1);b.onselectstart=b.onmousemove=L.Util.falseFn;return b},_loadTile:function(d,e,f){d._layer=this;d.onload=this._tileOnLoad;d.onerror=this._tileOnError;d.src=this.getTileUrl(e,f)},_tileOnLoad:function(){var b=this._layer;this.className+=" leaflet-tile-loaded";b.fire("tileload",{tile:this,url:this.src});b._tilesToLoad--;b._tilesToLoad||b.fire("load")},_tileOnError:function(){var b=this._layer;b.fire("tileerror",{tile:this,url:this.src});if(b=b.options.errorTileUrl){this.src=b}}});L.TileLayer.WMS=L.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(d,e){this._url=d;this.wmsParams=L.Util.extend({},this.defaultWmsParams);this.wmsParams.width=this.wmsParams.height=this.options.tileSize;for(var f in e){this.options.hasOwnProperty(f)||(this.wmsParams[f]=e[f])}L.Util.setOptions(this,e)},onAdd:function(b){this.wmsParams[parseFloat(this.wmsParams.version)>=1.3?"crs":"srs"]=b.options.crs.code;L.TileLayer.prototype.onAdd.call(this,b)},getTileUrl:function(c){var d=this.options.tileSize,c=c.multiplyBy(d),d=c.add(new L.Point(d,d)),c=this._map.unproject(c,this._zoom,!0),d=this._map.unproject(d,this._zoom,!0),c=this._map.options.crs.project(c),d=this._map.options.crs.project(d),d=[c.x,d.y,d.x,c.y].join(",");return this._url+L.Util.getParamString(this.wmsParams)+"&bbox="+d}});L.TileLayer.AGSDynamic=L.TileLayer.extend({defaultAgsParams:{minZoom:0,maxZoom:18,attribution:"",opacity:1,layers:null,format:"PNG8",transparent:"true",defintionQuery:"",cacheBuster:!1},initialize:function(d,e){this._url=d;this.agsDynamicParams=L.Util.extend({},this.defaultAgsParams);this.agsDynamicParams.width=this.agsDynamicParams.height=this.options.tileSize;for(var f in e){this.options.hasOwnProperty(f)||(this.agsDynamicParams[f]=e[f])}L.Util.setOptions(this,e)},onAdd:function(b){L.TileLayer.prototype.onAdd.call(this,b)},getTileUrl:function(f){var g=this.options.tileSize,f=f.multiplyBy(g),g=f.add(new L.Point(g,g)),f=this._map.unproject(f,this._zoom,!0),h=this._map.unproject(g,this._zoom,!0),g=this._map.options.crs.project(f),f=this._map.options.crs.project(h),h="&size="+this.options.tileSize+","+this.options.tileSize,j="&format="+this.agsDynamicParams.format,k="&transparent="+this.agsDynamicParams.transparent,g=this._url+"/export?bbox="+[g.x,f.y,f.x,g.y].join(",")+h+j+k+"&f=image";this.options.layers&&(g+="&layers="+this.agsDynamicParams.layers);this.agsDynamicParams.cacheBuster===!0&&(g+="&rnd="+Math.random()*1e+16);return g}});L.TileLayer.Canvas=L.TileLayer.extend({options:{async:!1},initialize:function(b){L.Util.setOptions(this,b)},_createTileProto:function(){this._canvasProto=L.DomUtil.create("canvas","leaflet-tile");var b=this.options.tileSize;this._canvasProto.width=b;this._canvasProto.height=b},_createTile:function(){var b=this._canvasProto.cloneNode(!1);b.onselectstart=b.onmousemove=L.Util.falseFn;return b},_loadTile:function(d,e,f){d._layer=this;this.drawTile(d,e,f);this.options.async||this.tileDrawn(d)},drawTile:function(){},tileDrawn:function(b){this._tileOnLoad.call(b)}});L.ImageOverlay=L.Class.extend({includes:L.Mixin.Events,initialize:function(c,d){this._url=c;this._bounds=d},onAdd:function(b){this._map=b;this._image||this._initImage();b.getPanes().overlayPane.appendChild(this._image);b.on("viewreset",this._reset,this);this._reset()},onRemove:function(b){b.getPanes().overlayPane.removeChild(this._image);b.off("viewreset",this._reset,this)},_initImage:function(){this._image=L.DomUtil.create("img","leaflet-image-layer");this._image.style.visibility="hidden";L.Util.extend(this._image,{galleryimg:"no",onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:this._onImageLoad,src:this._url})},_reset:function(){var c=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),d=this._map.latLngToLayerPoint(this._bounds.getSouthEast()).subtract(c);L.DomUtil.setPosition(this._image,c);this._image.style.width=d.x+"px";this._image.style.height=d.y+"px"},_onImageLoad:function(){this.style.visibility=""}});L.AgsDynamicLayer=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,layers:null,format:"PNG8",transparent:"true",defintionQuery:"",unloadInvisibleTiles:L.Browser.mobileWebkit},initialize:function(c,d){L.Util.setOptions(this,d);this._url=c},setLayers:function(b){this.options.layers=b;this._updateLayer()},getLayers:function(){return this.options.layers},setTransparent:function(b){this.options.transparent=b},getTransparent:function(){return this.options.transparent},setDefinitionQuery:function(b){this.options.defintionQuery=b},getDefinitionQuery:function(){return this.options.defintionQuery},setOpacity:function(b){if(this._image){this._image.style.opacity=b,this._image.style.webkitTransform+=" translate(0,0)"}this.options.opacity=b},getOpacity:function(){return this.options.opacity},reset:function(){this._reset()},update:function(){this._image.updating=!1;this._updateLayer()},show:function(){this._image.style.display="block";this._image.style.visibility="visible"},hide:function(){this._image.style.display="none"},isVisible:function(){return this._image.style.display==="block"},onAdd:function(b){this._map=b;this._reset();b.on("viewreset",this._reset,this);b.on("moveend",this._moveEnd,this);b.on("zoomend",this._zoomEnd,this)},onRemove:function(b){b.getPanes().overlayPane.removeChild(this._image);b.off("viewreset",this._reset,this);b.off("moveend",this._moveEnd,this);b.off("zoomend",this._zoomEnd,this)},_initImage:function(){this._image=L.DomUtil.create("img","leaflet-image-layer");this._image.style.visibility="hidden";this._image.style.opacity=this.options.opacity;this._image.style.display="block";L.Util.extend(this._image,{onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:this._onImageLoad,src:this._getImageUrl(),updating:!1,agsLayer:this,map:this._map});this._map.getPanes().overlayPane.appendChild(this._image)},_getImageUrl:function(){var c=this._map.getBounds(),d=this._map.getSize(),c=this._url+"/export?"+("bbox="+c.getSouthEast().lng+","+c.getSouthEast().lat+","+c.getNorthWest().lng+","+c.getNorthWest().lat+"&bboxsr=4326&imageSR=3857")+("&size="+d.x+","+d.y)+("&format="+this.options.format)+("&transparent="+this.options.transparent)+"&f=image";this.options.layers&&(c+="&layers="+this.options.layers);return c},_updateLayer:function(){if(!this._image.updating){this._image.updating=!0;this._image.src=this._getImageUrl();var c=this._map.latLngToLayerPoint(this._map.getBounds().getNorthWest()),d=this._map.latLngToLayerPoint(this._map.getBounds().getSouthEast()).subtract(c);L.DomUtil.setPosition(this._image,c);this._image.style.width=d.x+"px";this._image.style.height=d.y+"px"}},_moveEnd:function(){this._image.style.display="none";this._updateLayer()},_zoomEnd:function(){this._image.style.display="none";this._updateLayer()},_reset:function(){this._image&&this._map.getPanes().overlayPane.removeChild(this._image);this._initImage();this._updateLayer()},_onImageLoad:function(){this.style.visibility="visible";this.style.display="block";this.updating=!1}});L.AgsFeatureLayer=L.FeatureGroup.extend({includes:L.Mixin.Events,options:{definitionQuery:""},initialize:function(c,d){L.Util.setOptions(this,d);this.options.outFields.indexOf()===-1&&this.options.outFields.push("OBJECTID");this._url=c;this._layers={};this._pointToLayerFunc=d.pointToLayerFunc||function(b){return new L.Marker(b)}},onAdd:function(b){this._map=b;this.options.visible&&(this._updateLayer(),b.on("moveend",this._moveEnd,this),b.on("zoomend",this._zoomEnd,this))},onRemove:function(b){this._reset();b.off("moveend",this._moveEnd,this);b.off("zoomend",this._zoomEnd,this)},openPopup:function(b){(b=this._findLayer(b))&&b.openPopup()},show:function(){this._updateLayer();this._map.on("moveend",this._moveEnd,this);this._map.on("zoomend",this._zoomEnd,this)},hide:function(){this._map.off("moveend",this._moveEnd,this);this._map.off("zoomend",this._zoomEnd,this);this.clearLayers()},_reset:function(){this.clearLayers()},_findLayer:function(d){var e,f;for(f in this._layers){if(this._layers.hasOwnProperty(f)&&(e=this._layers[f],f.oid===d)){break}}return e},_updateLayerCallback:function(f){var g;if(f.features){for(var h=0,j=f.features.length;h<j;h++){if(g=f.features[h],g.geometry){var k=this._pointToLayer(g,f.fields);k.oid=g.attributes.OBJECTID;this.addLayer(k)}}}},_updateLayer:function(){this.clearLayers();var c=this._map.getBounds(),c="geometry="+c.getSouthEast().lng+","+c.getSouthEast().lat+","+c.getNorthWest().lng+","+c.getNorthWest().lat+"&geometrytype=esriGeometryEnvelope&inSr=4326&outSR=4326&returnGeometry=true",d="&outFields="+this.options.outFields.join();$.ajax({url:this._url+"/query?"+c+d+"&f=json",dataType:"jsonp",success:this._updateLayerCallback,error:function(){alert("error getting feature json.")},context:this})},_moveEnd:function(){this._updateLayer()},_zoomEnd:function(){this._updateLayer()},_pointToLayer:function(c,d){return this._pointToLayerFunc(new L.LatLng(c.geometry.y,c.geometry.x),c,d)}});L.TileLayer.Bing=L.TileLayer.extend({supportedTypes:["Road","Aerial","AerialWithLabels"],attributionTemplate:'<span>{copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span><span id="bing-logo" style="float:right;margin-left:3px;"><a target="_blank" href="http://www.bing.com/maps/"><img src="{logo}" height="15" /></a></span>',initialize:function(d,e,f){this._apiKey=d;this._mapType=e;this._loadMetadata();L.Util.setOptions(this,f)},_loadMetadata:function(){this._callbackId="_l_tilelayer_bing_"+L.TileLayer.Bing._callbackId++;window[this._callbackId]=L.Util.bind(L.TileLayer.Bing.processMetadata,this);var c="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this._mapType+L.Util.getParamString({key:this._apiKey,jsonp:this._callbackId,include:"ImageryProviders"}),d=document.createElement("script");d.type="text/javascript";d.src=c;d.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(d)},_onMetadataLoaded:function(){},onAdd:function(c,d){this.metadata?(L.TileLayer.prototype.onAdd.call(this,c,d),c.on("moveend",this._updateAttribution,this),this._updateAttribution()):this._onMetadataLoaded=L.Util.bind(function(){L.TileLayer.prototype.onAdd.call(this,c,d);c.on("moveend",this._updateAttribution,this);this._updateAttribution()},this)},onRemove:function(b){this._map.attributionControl&&this._map.attributionControl.removeAttribution(this.attribution);this._map.off("moveend",this._updateAttribution,this);L.TileLayer.prototype.onRemove.call(this,b)},getTileUrl:function(h,j){for(var k=this.options.subdomains,l=[],m=j,n,o;m>0;--m){n="0",o=1<<m-1,(h.x&o)!=0&&n++,(h.y&o)!=0&&(n++,n++),l.push(n)}return this._url.replace("{subdomain}",k[(h.x+h.y)%k.length]).replace("{quadkey}",l.join(""))},_updateAttribution:function(){if(this._map.attributionControl){if(this.options.opacity>0){var m=this.metadata,n=m.resourceSets[0].resources[0],o=this._map.getBounds(),n=n.imageryProviders,p=this._map.getZoom()+1,q="",r,s,u,t,v,w;s=0;for(u=n.length;s<u;++s){r=n[s];t=0;for(v=r.coverageAreas.length;t<v;++t){w=r.coverageAreas[t],p<=w.zoomMax&&p>=w.zoomMin&&w.bbox.contains(o)&&(q+=r.attribution+" ",t=v)}}this._map.attributionControl.removeAttribution(this.attribution);this.attribution=this.attributionTemplate.replace("{logo}",m.brandLogoUri).replace("{copyrights}",q);this._map.attributionControl.addAttribution(this.attribution)}else{this._map.attributionControl.removeAttribution(this.attribution)}}}});L.TileLayer.Bing._callbackId=0;L.TileLayer.Bing.processMetadata=function(h){if(h.authenticationResultCode!="ValidCredentials"){throw"Invalid Bing Maps API Key"}if(!h.resourceSets.length||!h.resourceSets[0].resources.length){throw"No resources returned, perhaps "+this._mapType+" is an invalid map type?"}if(h.statusCode!=200){throw"Bing Maps API request failed with status code "+h.statusCode}this.metadata=h;for(var h=h.resourceSets[0].resources[0],j=h.imageryProviders,k=0,l,m,n,o=document.getElementById(this._callbackId);k<j.length;k++){m=j[k];for(l=0;l<m.coverageAreas.length;l++){n=m.coverageAreas[l].bbox,m.coverageAreas[l].bbox=new L.LatLngBounds(new L.LatLng(n[0],n[1],!0),new L.LatLng(n[2],n[3],!0))}}this._url=h.imageUrl.replace("{culture}","en-US");this.options.subdomains=[].concat(h.imageUrlSubdomains);o.parentNode.removeChild(o);window[this._callbackId]=void 0;delete this._callbackId;this._onMetadataLoaded()};L.Popup=L.Class.extend({includes:L.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:new L.Point(0,2),autoPanPadding:new L.Point(5,5)},initialize:function(b){L.Util.setOptions(this,b)},onAdd:function(b){this._map=b;this._container||this._initLayout();this._updateContent();this._container.style.opacity="0";this._map._panes.popupPane.appendChild(this._container);this._map.on("viewreset",this._updatePosition,this);if(this._map.options.closePopupOnClick){this._map.on("preclick",this._close,this)}this._update();this._container.style.opacity="1";this._opened=!0},onRemove:function(b){b._panes.popupPane.removeChild(this._container);b.off("viewreset",this._updatePosition,this);b.off("click",this._close,this);this._container.style.opacity="0";this._opened=!1},setLatLng:function(b){this._latlng=b;this._opened&&this._update();return this},setContent:function(b){this._content=b;this._opened&&this._update();return this},_close:function(){this._opened&&this._map.removeLayer(this)},_initLayout:function(){this._container=L.DomUtil.create("div","leaflet-popup");if(this.options.closeButton){this._closeButton=L.DomUtil.create("a","leaflet-popup-close-button",this._container),this._closeButton.href="#close",this._closeButton.onclick=L.Util.bind(this._onCloseButtonClick,this)}this._wrapper=L.DomUtil.create("div","leaflet-popup-content-wrapper",this._container);L.DomEvent.disableClickPropagation(this._wrapper);this._contentNode=L.DomUtil.create("div","leaflet-popup-content",this._wrapper);this._tipContainer=L.DomUtil.create("div","leaflet-popup-tip-container",this._container);this._tip=L.DomUtil.create("div","leaflet-popup-tip",this._tipContainer)},_update:function(){this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.visibility="";this._adjustPan()},_updateContent:function(){if(this._content){typeof this._content=="string"?this._contentNode.innerHTML=this._content:(this._contentNode.innerHTML="",this._contentNode.appendChild(this._content))}},_updateLayout:function(){this._container.style.width="";this._container.style.whiteSpace="nowrap";var b=this._container.offsetWidth;this._container.style.width=(b>this.options.maxWidth?this.options.maxWidth:b<this.options.minWidth?this.options.minWidth:b)+"px";this._container.style.whiteSpace="";this._containerWidth=this._container.offsetWidth},_updatePosition:function(){var b=this._map.latLngToLayerPoint(this._latlng);this._containerBottom=-b.y-this.options.offset.y;this._containerLeft=b.x-Math.round(this._containerWidth/2)+this.options.offset.x;this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_adjustPan:function(){if(this.options.autoPan){var f=this._container.offsetHeight,g=this._map.layerPointToContainerPoint(new L.Point(this._containerLeft,-f-this._containerBottom)),h=new L.Point(0,0),j=this.options.autoPanPadding,k=this._map.getSize();if(g.x<0){h.x=g.x-j.x}if(g.x+this._containerWidth>k.x){h.x=g.x+this._containerWidth-k.x+j.x}if(g.y<0){h.y=g.y-j.y}if(g.y+f>k.y){h.y=g.y+f-k.y+j.y}(h.x||h.y)&&this._map.panBy(h)}},_onCloseButtonClick:function(b){this._close();L.DomEvent.stop(b)}});L.Icon=L.Class.extend({iconUrl:L.ROOT_URL+"images/marker.png",shadowUrl:L.ROOT_URL+"images/marker-shadow.png",iconSize:new L.Point(25,41),shadowSize:new L.Point(41,41),iconAnchor:new L.Point(13,41),popupAnchor:new L.Point(0,-33),initialize:function(b){if(b){this.iconUrl=b}},createIcon:function(){return this._createIcon("icon")},createShadow:function(){return this._createIcon("shadow")},_createIcon:function(e){var f=this[e+"Size"],g=this[e+"Url"],h=this._createImg(g);if(!g){return null}h.className="leaflet-marker-"+e;h.style.marginLeft=-this.iconAnchor.x+"px";h.style.marginTop=-this.iconAnchor.y+"px";if(f){h.style.width=f.x+"px",h.style.height=f.y+"px"}return h},_createImg:function(c){var d;L.Browser.ie6?(d=document.createElement("div"),d.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+c+'")'):(d=document.createElement("img"),d.src=c);return d}});L.Marker=L.Class.extend({includes:L.Mixin.Events,options:{icon:new L.Icon,title:"",clickable:!0,draggable:!1},initialize:function(c,d){L.Util.setOptions(this,d);this._latlng=c},onAdd:function(b){this._map=b;this._initIcon();b.on("viewreset",this._reset,this);this._reset()},onRemove:function(b){this._removeIcon();this.closePopup&&this.closePopup();b.off("viewreset",this._reset,this)},getLatLng:function(){return this._latlng},setLatLng:function(b){this._latlng=b;this._reset()},setIcon:function(b){this._removeIcon();this._icon=this._shadow=null;this.options.icon=b;this._initIcon();this._reset()},_initIcon:function(){if(!this._icon){this._icon=this.options.icon.createIcon();if(this.options.title){this._icon.title=this.options.title}this._initInteraction()}if(!this._shadow){this._shadow=this.options.icon.createShadow()}this._map._panes.markerPane.appendChild(this._icon);this._shadow&&this._map._panes.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this._map._panes.markerPane.removeChild(this._icon);this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow)},_reset:function(){var b=this._map.latLngToLayerPoint(this._latlng).round();L.DomUtil.setPosition(this._icon,b);this._shadow&&L.DomUtil.setPosition(this._shadow,b);this._icon.style.zIndex=b.y},_initInteraction:function(){if(this.options.clickable){this._icon.className+=" leaflet-clickable";L.DomEvent.addListener(this._icon,"click",this._onMouseClick,this);for(var c=["dblclick","mousedown","mouseover","mouseout"],d=0;d<c.length;d++){L.DomEvent.addListener(this._icon,c[d],this._fireMouseEvent,this)}}if(L.Handler.MarkerDrag){this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable()}},_onMouseClick:function(b){L.DomEvent.stopPropagation(b);(!this.dragging||!this.dragging.moved())&&this.fire(b.type)},_fireMouseEvent:function(b){this.fire(b.type);L.DomEvent.stopPropagation(b)}});L.Marker.include({openPopup:function(){this._popup.setLatLng(this._latlng);this._map.openPopup(this._popup);return this},closePopup:function(){this._popup&&this._popup._close()},bindPopup:function(c,d){d=L.Util.extend({offset:this.options.icon.popupAnchor},d);this._popup=new L.Popup(d);this._popup.setContent(c);this.on("click",this.openPopup,this);return this}});L.Path=L.Class.extend({includes:[L.Mixin.Events],statics:{CLIP_PADDING:0.5},options:{stroke:!0,color:"#0033ff",weight:5,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.2,clickable:!0,updateOnMoveEnd:!1},initialize:function(b){L.Util.setOptions(this,b)},onAdd:function(b){this._map=b;this._initElements();this._initEvents();this.projectLatlngs();this._updatePath();b.on("viewreset",this.projectLatlngs,this);this._updateTrigger=this.options.updateOnMoveEnd?"moveend":"viewreset";b.on(this._updateTrigger,this._updatePath,this)},onRemove:function(b){b._pathRoot.removeChild(this._container);b.off("viewreset",this._projectLatlngs,this);b.off(this._updateTrigger,this._updatePath,this)},projectLatlngs:function(){},setStyle:function(b){L.Util.setOptions(this,b);this._container&&this._updateStyle();return this},_initElements:function(){this._initRoot();this._initPath();this._initStyle()},_updateViewport:function(){var d=L.Path.CLIP_PADDING,e=this._map.getSize(),f=L.DomUtil.getPosition(this._map._mapPane).multiplyBy(-1).subtract(e.multiplyBy(d)),d=f.add(e.multiplyBy(1+d*2));this._map._pathViewport=new L.Bounds(f,d)},_redraw:function(){this.projectLatlngs();this._updatePath()}});L.Path.include({bindPopup:function(c,d){if(!this._popup||this._popup.options!==d){this._popup=new L.Popup(d)}this._popup.setContent(c);if(!this._openPopupAdded){this.on("click",this._openPopup,this),this._openPopupAdded=!0}return this},_openPopup:function(b){this._popup.setLatLng(b.latlng);this._map.openPopup(this._popup)}});L.Path.SVG_NS="http://www.w3.org/2000/svg";L.Browser.svg=!(!document.createElementNS||!document.createElementNS(L.Path.SVG_NS,"svg").createSVGRect);L.Path=L.Path.extend({statics:{SVG:L.Browser.svg},getPathString:function(){},_initElements:function(){this._initRoot();this._initPath();this._initStyle()},_initRoot:function(){if(!this._map._pathRoot){this._map._pathRoot=this._createElement("svg"),this._map._panes.overlayPane.appendChild(this._map._pathRoot),this._map.on("moveend",this._updateSvgViewport,this),this._updateSvgViewport()}},_updateSvgViewport:function(){this._updateViewport();var f=this._map._pathViewport,g=f.min,h=f.max,f=h.x-g.x,h=h.y-g.y,j=this._map._pathRoot,k=this._map._panes.overlayPane;L.Browser.mobileWebkit&&k.removeChild(j);L.DomUtil.setPosition(j,g);j.setAttribute("width",f);j.setAttribute("height",h);j.setAttribute("viewBox",[g.x,g.y,f,h].join(" "));L.Browser.mobileWebkit&&k.appendChild(j)},_initPath:function(){this._container=this._createElement("g");this._path=this._createElement("path");this._container.appendChild(this._path);this._map._pathRoot.appendChild(this._container)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round"));this.options.fill?this._path.setAttribute("fill-rule","evenodd"):this._path.setAttribute("fill","none");this._updateStyle()},_updateStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight));this.options.fill&&(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity))},_updatePath:function(){var b=this.getPathString();b||(b="M0 0");this._path.setAttribute("d",b)},_createElement:function(b){return document.createElementNS(L.Path.SVG_NS,b)},_initEvents:function(){if(this.options.clickable){L.Browser.vml||this._path.setAttribute("class","leaflet-clickable");L.DomEvent.addListener(this._container,"click",this._onMouseClick,this);for(var c=["dblclick","mousedown","mouseover","mouseout"],d=0;d<c.length;d++){L.DomEvent.addListener(this._container,c[d],this._fireMouseEvent,this)}}},_onMouseClick:function(b){(!this._map.dragging||!this._map.dragging.moved())&&this._fireMouseEvent(b)},_fireMouseEvent:function(b){this.hasEventListeners(b.type)&&(this.fire(b.type,{latlng:this._map.mouseEventToLatLng(b),layerPoint:this._map.mouseEventToLayerPoint(b)}),L.DomEvent.stopPropagation(b))}});L.Browser.vml=function(){var b=document.createElement("div");b.innerHTML='<v:shape adj="1"/>';b=b.firstChild;b.style.behavior="url(#default#VML)";return b&&typeof b.adj=="object"}();L.Path=L.Browser.svg||!L.Browser.vml?L.Path:L.Path.extend({statics:{VML:!0,CLIP_PADDING:0.02},_createElement:function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(c){return document.createElement("<lvml:"+c+' class="lvml">')}}catch(b){return function(c){return document.createElement("<"+c+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initRoot:function(){if(!this._map._pathRoot){this._map._pathRoot=document.createElement("div"),this._map._pathRoot.className="leaflet-vml-container",this._map._panes.overlayPane.appendChild(this._map._pathRoot),this._map.on("moveend",this._updateViewport,this),this._updateViewport()}},_initPath:function(){this._container=this._createElement("shape");this._container.className+=" leaflet-vml-shape"+(this.options.clickable?" leaflet-clickable":"");this._container.coordsize="1 1";this._path=this._createElement("path");this._container.appendChild(this._path);this._map._pathRoot.appendChild(this._container)},_initStyle:function(){this.options.stroke?(this._stroke=this._createElement("stroke"),this._stroke.endcap="round",this._container.appendChild(this._stroke)):this._container.stroked=!1;this.options.fill?(this._container.filled=!0,this._fill=this._createElement("fill"),this._container.appendChild(this._fill)):this._container.filled=!1;this._updateStyle()},_updateStyle:function(){if(this.options.stroke){this._stroke.weight=this.options.weight+"px",this._stroke.color=this.options.color,this._stroke.opacity=this.options.opacity}if(this.options.fill){this._fill.color=this.options.fillColor||this.options.color,this._fill.opacity=this.options.fillOpacity}},_updatePath:function(){this._container.style.display="none";this._path.v=this.getPathString()+" ";this._container.style.display=""}});L.Browser.canvas=function(){return !!document.createElement("canvas").getContext}();L.Path=L.Path.SVG&&!window.L_PREFER_CANVAS||!L.Browser.canvas?L.Path:L.Path.extend({statics:{CANVAS:!0,SVG:!1},options:{updateOnMoveEnd:!0},_initElements:function(){this._initRoot()},_initRoot:function(){var c=this._map._pathRoot,d=this._map._canvasCtx;if(!c){c=this._map._pathRoot=document.createElement("canvas"),c.style.position="absolute",d=this._map._canvasCtx=c.getContext("2d"),d.lineCap="round",d.lineJoin="round",this._map._panes.overlayPane.appendChild(c),this._map.on("moveend",this._updateCanvasViewport,this),this._updateCanvasViewport()}this._ctx=d},_updateStyle:function(){if(this.options.stroke){this._ctx.lineWidth=this.options.weight,this._ctx.strokeStyle=this.options.color}if(this.options.fill){this._ctx.fillStyle=this.options.fillColor||this.options.color}},_drawPath:function(){var g,h,j,k,l,m;this._ctx.beginPath();g=0;for(j=this._parts.length;g<j;g++){h=0;for(k=this._parts[g].length;h<k;h++){l=this._parts[g][h],m=(h===0?"move":"line")+"To",this._ctx[m](l.x,l.y)}this instanceof L.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return !this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){this._drawPath();this._ctx.save();this._updateStyle();var c=this.options.opacity,d=this.options.fillOpacity;if(this.options.fill){if(d<1){this._ctx.globalAlpha=d}this._ctx.fill()}if(this.options.stroke){if(c<1){this._ctx.globalAlpha=c}this._ctx.stroke()}this._ctx.restore()}},_updateCanvasViewport:function(){this._updateViewport();var d=this._map._pathViewport,e=d.min,d=d.max.subtract(e),f=this._map._pathRoot;L.DomUtil.setPosition(f,e);f.width=d.x;f.height=d.y;f.getContext("2d").translate(-e.x,-e.y)},_initEvents:function(){if(this.options.clickable){this._map.on("click",this._onClick,this)}},_onClick:function(b){this._containsPoint(b.layerPoint)&&this.fire("click",b)},onRemove:function(b){b.off("viewreset",this._projectLatlngs,this);b.off(this._updateTrigger,this._updatePath,this);b.fire(this._updateTrigger)}});L.Polyline=L.Path.extend({initialize:function(c,d){L.Path.prototype.initialize.call(this,d);this._latlngs=c},options:{smoothFactor:1,noClip:!1,updateOnMoveEnd:!0},projectLatlngs:function(){this._originalPoints=[];for(var c=0,d=this._latlngs.length;c<d;c++){this._originalPoints[c]=this._map.latLngToLayerPoint(this._latlngs[c])}},getPathString:function(){for(var d=0,e=this._parts.length,f="";d<e;d++){f+=this._getPathPartStr(this._parts[d])}return f},getLatLngs:function(){return this._latlngs},setLatLngs:function(b){this._latlngs=b;this._redraw();return this},addLatLng:function(b){this._latlngs.push(b);this._redraw();return this},spliceLatLngs:function(){var b=[].splice.apply(this._latlngs,arguments);this._redraw();return b},closestLayerPoint:function(m){for(var n=Infinity,o=this._parts,p,q,r=null,s=0,u=o.length;s<u;s++){for(var t=o[s],v=1,w=t.length;v<w;v++){if(p=t[v-1],q=t[v],p=L.LineUtil._sqClosestPointOnSegment(m,p,q),p._sqDist<n){n=p._sqDist,r=p}}}if(r){r.distance=Math.sqrt(n)}return r},_getPathPartStr:function(g){for(var h=L.Path.VML,j=0,k=g.length,l="",m;j<k;j++){m=g[j],h&&m._round(),l+=(j?"L":"M")+m.x+" "+m.y}return l},_clipPoints:function(){var h=this._originalPoints,k=h.length,l,m,n;if(this.options.noClip){this._parts=[h]}else{var o=this._parts=[],p=this._map._pathViewport,q=L.LineUtil;for(m=l=0;l<k-1;l++){if(n=q.clipSegment(h[l],h[l+1],p,l)){if(o[m]=o[m]||[],o[m].push(n[0]),n[1]!=h[l+1]||l==k-2){o[m].push(n[1]),m++}}}}},_simplifyPoints:function(){for(var e=this._parts,f=L.LineUtil,g=0,h=e.length;g<h;g++){e[g]=f.simplify(e[g],this.options.smoothFactor)}},_updatePath:function(){this._clipPoints();this._simplifyPoints();L.Path.prototype._updatePath.call(this)}});L.Polyline.include(!L.Path.CANVAS?{}:{_containsPoint:function(k,l){var m,n,o,p,q,s,r=this.options.weight/2;L.Browser.touch&&(r+=10);m=0;for(p=this._parts.length;m<p;m++){s=this._parts[m];n=0;q=s.length;for(o=q-1;n<q;o=n++){if(l||n!==0){if(o=L.LineUtil.pointToSegmentDistance(k,s[o],s[n]),o<=r){return !0}}}}return !1}});L.Polygon=L.Polyline.extend({options:{fill:!0},initialize:function(c,d){L.Polyline.prototype.initialize.call(this,c,d);if(c[0] instanceof Array){this._latlngs=c[0],this._holes=c.slice(1)}},projectLatlngs:function(){L.Polyline.prototype.projectLatlngs.call(this);this._holePoints=[];if(this._holes){for(var e=0,f=this._holes.length;e<f;e++){this._holePoints[e]=[];for(var g=0,h=this._holes[e].length;g<h;g++){this._holePoints[e][g]=this._map.latLngToLayerPoint(this._holes[e][g])}}}},_clipPoints:function(){var e=[];this._parts=[this._originalPoints].concat(this._holePoints);if(!this.options.noClip){for(var f=0,g=this._parts.length;f<g;f++){var h=L.PolyUtil.clipPolygon(this._parts[f],this._map._pathViewport);h.length&&e.push(h)}this._parts=e}},_getPathPartStr:function(b){return L.Polyline.prototype._getPathPartStr.call(this,b)+(L.Browser.svg?"z":"x")}});L.Polygon.include(!L.Path.CANVAS?{}:{_containsPoint:function(k){var l=!1,m,n,o,p,q,s,r;if(L.Polyline.prototype._containsPoint.call(this,k,!0)){return !0}p=0;for(s=this._parts.length;p<s;p++){m=this._parts[p];q=0;r=m.length;for(o=r-1;q<r;o=q++){n=m[q],o=m[o],n.y>k.y!=o.y>k.y&&k.x<(o.x-n.x)*(k.y-n.y)/(o.y-n.y)+n.x&&(l=!l)}}return l}});(function(){function b(c){return L.FeatureGroup.extend({initialize:function(d,e){this._layers={};this._options=e;this.setLatLngs(d)},setStyle:function(d){for(var e in this._layers){this._layers.hasOwnProperty(e)&&this._layers[e].setStyle&&this._layers[e].setStyle(d)}},setLatLngs:function(a){var f=0,g=a.length;for(this._iterateLayers(function(d){f<g?d.setLatLngs(a[f++]):this.removeLayer(d)},this);f<g;){this.addLayer(new c(a[f++],this._options))}}})}L.MultiPolyline=b(L.Polyline);L.MultiPolygon=b(L.Polygon)})();L.Circle=L.Path.extend({initialize:function(d,e,f){L.Path.prototype.initialize.call(this,f);this._latlng=d;this._mRadius=e},options:{fill:!0},setLatLng:function(b){this._latlng=b;this._redraw();return this},setRadius:function(b){this._mRadius=b;this._redraw();return this},projectLatlngs:function(){var b=this._map.options.scale(this._map._zoom);this._point=this._map.latLngToLayerPoint(this._latlng);this._radius=this._mRadius/40075017*b},getPathString:function(){var c=this._point,d=this._radius;if(this._checkIfEmpty()){return""}return L.Browser.svg?"M"+c.x+","+(c.y-d)+"A"+d+","+d+",0,1,1,"+(c.x-0.1)+","+(c.y-d)+" z":(c._round(),d=Math.round(d),"AL "+c.x+","+c.y+" "+d+","+d+" 0,23592600")},_checkIfEmpty:function(){var d=this._map._pathViewport,e=this._radius,f=this._point;return f.x-e>d.max.x||f.y-e>d.max.y||f.x+e<d.min.x||f.y+e<d.min.y}});L.Circle.include(!L.Path.CANVAS?{}:{_drawPath:function(){var b=this._point;this._ctx.beginPath();this._ctx.arc(b.x,b.y,this._radius,0,Math.PI*2)},_containsPoint:function(c){var d=this.options.stroke?this.options.weight/2:0;return c.distanceTo(this._point)<=this._radius+d}});L.CircleMarker=L.Circle.extend({options:{radius:10,weight:2},initialize:function(c,d){L.Circle.prototype.initialize.call(this,c,null,d);this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},setRadius:function(b){this._radius=b;this._redraw();return this}});L.GeoJSON=L.LayerGroup.extend({includes:L.Mixin.Events,initialize:function(c,d){L.Util.setOptions(this,d);this._geojson=c;this._layers={};c&&this.addGeoJSON(c)},addGeoJSON:function(d){if(d.features){for(var e=0,f=d.features.length;e<f;e++){this.addGeoJSON(d.features[e])}}else{e=d.type=="Feature"?d.geometry:d,f=L.GeoJSON.geometryToLayer(e,this.options.pointToLayer),this.fire("featureparse",{layer:f,properties:d.properties,geometryType:e.type,bbox:d.bbox,id:d.id}),this.addLayer(f)}}});L.Util.extend(L.GeoJSON,{geometryToLayer:function(h,j){var k=h.coordinates,l,m,n,o=[];switch(h.type){case"Point":return l=this.coordsToLatLng(k),j?j(l):new L.Marker(l);case"MultiPoint":m=0;for(n=k.length;m<n;m++){l=this.coordsToLatLng(k[m]),l=j?j(l):new L.Marker(l),o.push(l)}return new L.FeatureGroup(o);case"LineString":return k=this.coordsToLatLngs(k),new L.Polyline(k);case"Polygon":return k=this.coordsToLatLngs(k,1),new L.Polygon(k);case"MultiLineString":return k=this.coordsToLatLngs(k,1),new L.MultiPolyline(k);case"MultiPolygon":return k=this.coordsToLatLngs(k,2),new L.MultiPolygon(k);case"GeometryCollection":m=0;for(n=h.geometries.length;m<n;m++){l=this.geometryToLayer(h.geometries[m]),o.push(l)}return new L.FeatureGroup(o);default:throw Error("Invalid GeoJSON object.")}},coordsToLatLng:function(e,f){var g=parseFloat(e[f?0:1]),h=parseFloat(e[f?1:0]);return new L.LatLng(g,h)},coordsToLatLngs:function(h,j,k){var l,m=[],n,o=h.length;for(n=0;n<o;n++){l=j?this.coordsToLatLngs(h[n],j-1,k):this.coordsToLatLng(h[n],k),m.push(l)}return m}});L.Handler=L.Class.extend({initialize:function(b){this._map=b},enabled:function(){return !!this._enabled}});L.Handler.MapDrag=L.Handler.extend({enable:function(){if(!this._enabled){if(!this._draggable){this._draggable=new L.Draggable(this._map._mapPane,this._map._container),this._draggable.on("dragstart",this._onDragStart,this),this._draggable.on("drag",this._onDrag,this),this._draggable.on("dragend",this._onDragEnd,this)}this._draggable.enable();this._enabled=!0}},disable:function(){if(this._enabled){this._draggable.disable(),this._enabled=!1}},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._map.fire("movestart");this._map.fire("dragstart")},_onDrag:function(){this._map.fire("move");this._map.fire("drag")},_onDragEnd:function(){this._map.fire("moveend");this._map.fire("dragend")}});L.Handler.TouchZoom=L.Handler.extend({enable:function(){if(L.Browser.touch&&!this._enabled){L.DomEvent.addListener(this._map._container,"touchstart",this._onTouchStart,this),this._enabled=!0}},disable:function(){if(this._enabled){L.DomEvent.removeListener(this._map._container,"touchstart",this._onTouchStart,this),this._enabled=!1}},_onTouchStart:function(e){if(e.touches&&!(e.touches.length!=2||this._map._animatingZoom)){var f=this._map.mouseEventToLayerPoint(e.touches[0]),g=this._map.mouseEventToLayerPoint(e.touches[1]),h=this._map.containerPointToLayerPoint(this._map.getSize().divideBy(2));this._startCenter=f.add(g).divideBy(2,!0);this._startDist=f.distanceTo(g);this._moved=!1;this._zooming=!0;this._centerOffset=h.subtract(this._startCenter);L.DomEvent.addListener(document,"touchmove",this._onTouchMove,this);L.DomEvent.addListener(document,"touchend",this._onTouchEnd,this);L.DomEvent.preventDefault(e)}},_onTouchMove:function(d){if(d.touches&&d.touches.length==2){if(!this._moved){this._map._mapPane.className+=" leaflet-zoom-anim",this._map._prepareTileBg(),this._moved=!0}var e=this._map.mouseEventToLayerPoint(d.touches[0]),f=this._map.mouseEventToLayerPoint(d.touches[1]);this._scale=e.distanceTo(f)/this._startDist;this._delta=e.add(f).divideBy(2,!0).subtract(this._startCenter);this._map._tileBg.style.webkitTransform=[L.DomUtil.getTranslateString(this._delta),L.DomUtil.getScaleString(this._scale,this._startCenter)].join(" ");L.DomEvent.preventDefault(d)}},_onTouchEnd:function(){if(this._moved&&this._zooming){this._zooming=!1;var e=this._map.getZoom(),f=Math.log(this._scale)/Math.LN2,f=this._map._limitZoom(e+(f>0?Math.ceil(f):Math.floor(f))),e=f-e,g=this._centerOffset.subtract(this._delta).divideBy(this._scale),h=this._map.unproject(this._map.getPixelOrigin().add(this._startCenter).add(g));L.DomEvent.removeListener(document,"touchmove",this._onTouchMove);L.DomEvent.removeListener(document,"touchend",this._onTouchEnd);this._map._runAnimation(h,f,Math.pow(2,e)/this._scale,this._startCenter.add(g))}}});L.Handler.ScrollWheelZoom=L.Handler.extend({enable:function(){if(!this._enabled){L.DomEvent.addListener(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0,this._enabled=!0}},disable:function(){if(this._enabled){L.DomEvent.removeListener(this._map._container,"mousewheel",this._onWheelScroll),this._enabled=!1}},_onWheelScroll:function(b){this._delta+=L.DomEvent.getWheelDelta(b);this._lastMousePos=this._map.mouseEventToContainerPoint(b);clearTimeout(this._timer);this._timer=setTimeout(L.Util.bind(this._performZoom,this),50);L.DomEvent.preventDefault(b)},_performZoom:function(){var c=Math.round(this._delta),c=Math.max(Math.min(c,4),-4);this._delta=0;if(c){var d=this._getCenterForScrollWheelZoom(this._lastMousePos,c),c=this._map.getZoom()+c;this._map._limitZoom(c)!=this._map._zoom&&this._map.setView(d,c)}},_getCenterForScrollWheelZoom:function(e,f){var g=this._map.getPixelBounds().getCenter(),h=this._map.getSize().divideBy(2),h=e.subtract(h).multiplyBy(1-Math.pow(2,-f));return this._map.unproject(g.add(h),this._map._zoom,!0)}});L.Handler.DoubleClickZoom=L.Handler.extend({enable:function(){if(!this._enabled){this._map.on("dblclick",this._onDoubleClick,this._map),this._enabled=!0}},disable:function(){if(this._enabled){this._map.off("dblclick",this._onDoubleClick,this._map),this._enabled=!1}},_onDoubleClick:function(b){this.setView(b.latlng,this._zoom+1)}});L.Handler.ShiftDragZoom=L.Handler.extend({initialize:function(b){this._map=b;this._container=b._container;this._pane=b._panes.overlayPane},enable:function(){if(!this._enabled){L.DomEvent.addListener(this._container,"mousedown",this._onMouseDown,this),this._enabled=!0}},disable:function(){if(this._enabled){L.DomEvent.removeListener(this._container,"mousedown",this._onMouseDown),this._enabled=!1}},_onMouseDown:function(b){if(!b.shiftKey||b.which!=1&&b.button!=1){return !1}L.DomUtil.disableTextSelection();this._startLayerPoint=this._map.mouseEventToLayerPoint(b);this._box=L.DomUtil.create("div","leaflet-zoom-box",this._pane);L.DomUtil.setPosition(this._box,this._startLayerPoint);this._container.style.cursor="crosshair";L.DomEvent.addListener(document,"mousemove",this._onMouseMove,this);L.DomEvent.addListener(document,"mouseup",this._onMouseUp,this);L.DomEvent.preventDefault(b)},_onMouseMove:function(d){var e=this._map.mouseEventToLayerPoint(d),d=e.x-this._startLayerPoint.x,f=e.y-this._startLayerPoint.y,e=new L.Point(Math.min(e.x,this._startLayerPoint.x),Math.min(e.y,this._startLayerPoint.y));L.DomUtil.setPosition(this._box,e);this._box.style.width=Math.abs(d)-4+"px";this._box.style.height=Math.abs(f)-4+"px"},_onMouseUp:function(b){this._pane.removeChild(this._box);this._container.style.cursor="";L.DomUtil.enableTextSelection();L.DomEvent.removeListener(document,"mousemove",this._onMouseMove);L.DomEvent.removeListener(document,"mouseup",this._onMouseUp);b=this._map.mouseEventToLayerPoint(b);this._map.fitBounds(new L.LatLngBounds(this._map.layerPointToLatLng(this._startLayerPoint),this._map.layerPointToLatLng(b)))}});L.Handler.MarkerDrag=L.Handler.extend({initialize:function(b){this._marker=b},enable:function(){if(!this._enabled){if(!this._draggable){this._draggable=new L.Draggable(this._marker._icon,this._marker._icon),this._draggable.on("dragstart",this._onDragStart,this),this._draggable.on("drag",this._onDrag,this),this._draggable.on("dragend",this._onDragEnd,this)}this._draggable.enable();this._enabled=!0}},disable:function(){if(this._enabled){this._draggable.disable(),this._enabled=!1}},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup();this._marker.fire("movestart");this._marker.fire("dragstart")},_onDrag:function(){var b=L.DomUtil.getPosition(this._marker._icon);this._marker._shadow&&L.DomUtil.setPosition(this._marker._shadow,b);this._marker._latlng=this._marker._map.layerPointToLatLng(b);this._marker.fire("move");this._marker.fire("drag")},_onDragEnd:function(){this._marker.fire("moveend");this._marker.fire("dragend")}});L.Control={};L.Control.Position={TOP_LEFT:"topLeft",TOP_RIGHT:"topRight",BOTTOM_LEFT:"bottomLeft",BOTTOM_RIGHT:"bottomRight"};L.Control.Zoom=L.Class.extend({onAdd:function(b){this._map=b;this._container=L.DomUtil.create("div","leaflet-control-zoom");this._zoomInButton=this._createButton("Zoom in","leaflet-control-zoom-in",this._map.zoomIn,this._map);this._zoomOutButton=this._createButton("Zoom out","leaflet-control-zoom-out",this._map.zoomOut,this._map);this._container.appendChild(this._zoomInButton);this._container.appendChild(this._zoomOutButton)},getContainer:function(){return this._container},getPosition:function(){return L.Control.Position.TOP_LEFT},_createButton:function(f,g,h,j){var k=document.createElement("a");k.href="#";k.title=f;k.className=g;L.DomEvent.disableClickPropagation(k);L.DomEvent.addListener(k,"click",L.DomEvent.preventDefault);L.DomEvent.addListener(k,"click",h,j);return k}});L.Control.Attribution=L.Class.extend({onAdd:function(b){this._container=L.DomUtil.create("div","leaflet-control-attribution");this._map=b;this._prefix='Powered by <a href="http://leaflet.cloudmade.com">Leaflet</a>';this._attributions={};this._update()},getPosition:function(){return L.Control.Position.BOTTOM_RIGHT},getContainer:function(){return this._container},setPrefix:function(b){this._prefix=b;this._update()},addAttribution:function(b){b&&(this._attributions[b]=!0,this._update())},removeAttribution:function(b){b&&(delete this._attributions[b],this._update())},_update:function(){if(this._map){var c=[],d;for(d in this._attributions){this._attributions.hasOwnProperty(d)&&c.push(d)}d=[];this._prefix&&d.push(this._prefix);c.length&&d.push(c.join(", "));this._container.innerHTML=d.join(" &mdash; ")}}});L.Control.Layers=L.Class.extend({options:{collapsed:!0},initialize:function(e,f,g){L.Util.setOptions(this,g);this._layers={};for(var h in e){e.hasOwnProperty(h)&&this._addLayer(e[h],h)}for(h in f){f.hasOwnProperty(h)&&this._addLayer(f[h],h,!0)}},onAdd:function(b){this._map=b;this._initLayout();this._update()},getContainer:function(){return this._container},getPosition:function(){return L.Control.Position.TOP_RIGHT},addBaseLayer:function(c,d){this._addLayer(c,d);this._update();return this},addOverlay:function(c,d){this._addLayer(c,d,!0);this._update();return this},removeLayer:function(b){delete this._layers[L.Util.stamp(b)];this._update();return this},_initLayout:function(){this._container=L.DomUtil.create("div","leaflet-control-layers");L.DomEvent.disableClickPropagation(this._container);this._form=L.DomUtil.create("form","leaflet-control-layers-list");if(this.options.collapsed){L.DomEvent.addListener(this._container,"mouseover",this._expand,this);L.DomEvent.addListener(this._container,"mouseout",this._collapse,this);var b=this._layersLink=L.DomUtil.create("a","leaflet-control-layers-toggle");b.href="#";b.title="Layers";L.DomEvent.addListener(b,"focus",this._expand,this);L.DomEvent.addListener(this._map,L.Draggable.START,this._collapse,this);this._container.appendChild(b)}else{this._expand()}this._baseLayersList=L.DomUtil.create("div","leaflet-control-layers-base",this._form);this._separator=L.DomUtil.create("div","leaflet-control-layers-separator",this._form);this._overlaysList=L.DomUtil.create("div","leaflet-control-layers-overlays",this._form);this._container.appendChild(this._form)},_addLayer:function(d,e,f){this._layers[L.Util.stamp(d)]={layer:d,name:e,overlay:f}},_update:function(){if(this._container){this._baseLayersList.innerHTML="";this._overlaysList.innerHTML="";var e=!1,f=!1,g;for(g in this._layers){if(this._layers.hasOwnProperty(g)){var h=this._layers[g];this._addItem(h);f=f||h.overlay;e=e||!h.overlay}}this._separator.style.display=f&&e?"":"none"}},_addItem:function(e){var f=document.createElement("label"),g=document.createElement("input");if(!e.overlay){g.name="leaflet-base-layers"}g.type=e.overlay?"checkbox":"radio";g.checked=this._map.hasLayer(e.layer);g.layerId=L.Util.stamp(e.layer);L.DomEvent.addListener(g,"click",this._onInputClick,this);var h=document.createTextNode(" "+e.name);f.appendChild(g);f.appendChild(h);(e.overlay?this._overlaysList:this._baseLayersList).appendChild(f)},_onInputClick:function(){var f,g,h,j=this._form.getElementsByTagName("input"),k=j.length;for(f=0;f<k;f++){g=j[f],h=this._layers[g.layerId],g.checked?this._map.addLayer(h.layer,!h.overlay):this._map.removeLayer(h.layer)}},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}});L.Map=L.Class.extend({includes:L.Mixin.Events,options:{crs:L.CRS.EPSG3857||L.CRS.EPSG4326,scale:function(b){return 256*(1<<b)},center:null,zoom:null,layers:[],dragging:!0,touchZoom:L.Browser.touch&&!L.Browser.android,scrollWheelZoom:!L.Browser.touch,doubleClickZoom:!0,shiftDragZoom:!0,zoomControl:!0,attributionControl:!0,fadeAnimation:L.DomUtil.TRANSITION&&!L.Browser.android,zoomAnimation:L.DomUtil.TRANSITION&&!L.Browser.android&&!L.Browser.mobileOpera,trackResize:!0,closePopupOnClick:!0},initialize:function(e,f){L.Util.setOptions(this,f);this._container=L.DomUtil.get(e);this._initLayout();L.DomEvent&&(this._initEvents(),L.Handler&&this._initInteraction(),L.Control&&this._initControls());var g=this.options.center,h=this.options.zoom;g!==null&&h!==null&&this.setView(g,h,!0);g=this.options.layers;g=g instanceof Array?g:[g];this._tileLayersNum=0;this._initLayers(g)},setView:function(c,d){this._resetView(c,this._limitZoom(d));return this},setZoom:function(b){return this.setView(this.getCenter(),b)},zoomIn:function(){return this.setZoom(this._zoom+1)},zoomOut:function(){return this.setZoom(this._zoom-1)},fitBounds:function(c){var d=this.getBoundsZoom(c);return this.setView(c.getCenter(),d)},fitWorld:function(){var c=new L.LatLng(-60,-170),d=new L.LatLng(85,179);return this.fitBounds(new L.LatLngBounds(c,d))},panTo:function(b){return this.setView(b,this._zoom)},panBy:function(b){this.fire("movestart");this._rawPanBy(b);this.fire("move");this.fire("moveend");return this},addLayer:function(d,e){var f=L.Util.stamp(d);if(this._layers[f]){return this}this._layers[f]=d;if(d.options&&!isNaN(d.options.maxZoom)){this._layersMaxZoom=Math.max(this._layersMaxZoom||0,d.options.maxZoom)}if(d.options&&!isNaN(d.options.minZoom)){this._layersMinZoom=Math.min(this._layersMinZoom||Infinity,d.options.minZoom)}this.options.zoomAnimation&&L.TileLayer&&d instanceof L.TileLayer&&(this._tileLayersNum++,d.on("load",this._onTileLayerLoad,this));this.attributionControl&&d.getAttribution&&this.attributionControl.addAttribution(d.getAttribution());f=function(){d.onAdd(this,e);this.fire("layeradd",{layer:d})};if(this._loaded){f.call(this)}else{this.on("load",f,this)}return this},removeLayer:function(c){var d=L.Util.stamp(c);this._layers[d]&&(c.onRemove(this),delete this._layers[d],this.options.zoomAnimation&&L.TileLayer&&c instanceof L.TileLayer&&(this._tileLayersNum--,c.off("load",this._onTileLayerLoad,this)),this.attributionControl&&c.getAttribution&&this.attributionControl.removeAttribution(c.getAttribution()),this.fire("layerremove",{layer:c}));return this},hasLayer:function(b){return L.Util.stamp(b) in this._layers},invalidateSize:function(){this._sizeChanged=!0;this.fire("move");clearTimeout(this._sizeTimer);this._sizeTimer=setTimeout(L.Util.bind(function(){this.fire("moveend")},this),200);return this},getCenter:function(c){var d=this.getSize().divideBy(2);return this.unproject(this._getTopLeftPoint().add(d),this._zoom,c)},getZoom:function(){return this._zoom},getBounds:function(){var c=this.getPixelBounds(),d=this.unproject(new L.Point(c.min.x,c.max.y)),c=this.unproject(new L.Point(c.max.x,c.min.y));return new L.LatLngBounds(d,c)},getMinZoom:function(){return isNaN(this.options.minZoom)?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return isNaN(this.options.maxZoom)?this._layersMaxZoom||Infinity:this.options.maxZoom},getBoundsZoom:function(h){var j=this.getSize(),k=this.getMinZoom(),l=this.getMaxZoom(),m=h.getNorthEast(),h=h.getSouthWest(),n,o;do{k++,n=this.project(m,k),o=this.project(h,k),n=new L.Point(n.x-o.x,o.y-n.y)}while(n.x<=j.x&&n.y<=j.y&&k<=l);return k-1},getSize:function(){if(!this._size||this._sizeChanged){this._size=new L.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1}return this._size},getPixelBounds:function(){var c=this._getTopLeftPoint(),d=this.getSize();return new L.Bounds(c,c.add(d))},getPixelOrigin:function(){return this._initialTopLeftPoint},getPanes:function(){return this._panes},mouseEventToContainerPoint:function(b){return L.DomEvent.getMousePosition(b,this._container)},mouseEventToLayerPoint:function(b){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(b))},mouseEventToLatLng:function(b){return this.layerPointToLatLng(this.mouseEventToLayerPoint(b))},containerPointToLayerPoint:function(b){return b.subtract(L.DomUtil.getPosition(this._mapPane))},layerPointToContainerPoint:function(b){return b.add(L.DomUtil.getPosition(this._mapPane))},layerPointToLatLng:function(b){return this.unproject(b.add(this._initialTopLeftPoint))},latLngToLayerPoint:function(b){return this.project(b)._round()._subtract(this._initialTopLeftPoint)},project:function(c,d){d=typeof d=="undefined"?this._zoom:d;return this.options.crs.latLngToPoint(c,this.options.scale(d))},unproject:function(d,e,f){e=typeof e=="undefined"?this._zoom:e;return this.options.crs.pointToLatLng(d,this.options.scale(e),f)},_initLayout:function(){var c=this._container;c.className+=" leaflet-container";this.options.fadeAnimation&&(c.className+=" leaflet-fade-anim");var d=L.DomUtil.getStyle(c,"position");if(d!="absolute"&&d!="relative"){c.style.position="relative"}this._initPanes();this._initControlPos&&this._initControlPos()},_initPanes:function(){var b=this._panes={};this._mapPane=b.mapPane=this._createPane("leaflet-map-pane",this._container);this._tilePane=b.tilePane=this._createPane("leaflet-tile-pane",this._mapPane);this._objectsPane=b.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane);b.shadowPane=this._createPane("leaflet-shadow-pane");b.overlayPane=this._createPane("leaflet-overlay-pane");b.markerPane=this._createPane("leaflet-marker-pane");b.popupPane=this._createPane("leaflet-popup-pane")},_createPane:function(c,d){return L.DomUtil.create("div",c,d||this._objectsPane)},_resetView:function(e,f,g){var h=this._zoom!=f;this.fire("movestart");this._zoom=f;this._initialTopLeftPoint=this._getNewTopLeftPoint(e);g?this._initialTopLeftPoint._add(L.DomUtil.getPosition(this._mapPane)):L.DomUtil.setPosition(this._mapPane,new L.Point(0,0));this._tileLayersToLoad=this._tileLayersNum;this.fire("viewreset");this.fire("move");h&&this.fire("zoomend");this.fire("moveend");if(!this._loaded){this._loaded=!0,this.fire("load")}},_initLayers:function(d){this._layers={};for(var e=0,f=d.length;e<f;e++){this.addLayer(d[e])}},_initControls:function(){this.options.zoomControl&&this.addControl(new L.Control.Zoom);if(this.options.attributionControl){this.attributionControl=new L.Control.Attribution,this.addControl(this.attributionControl)}},_rawPanBy:function(c){var d=L.DomUtil.getPosition(this._mapPane);L.DomUtil.setPosition(this._mapPane,d.subtract(c))},_initEvents:function(){L.DomEvent.addListener(this._container,"click",this._onMouseClick,this);for(var c=["dblclick","mousedown","mouseenter","mouseleave","mousemove"],d=0;d<c.length;d++){L.DomEvent.addListener(this._container,c[d],this._fireMouseEvent,this)}this.options.trackResize&&L.DomEvent.addListener(window,"resize",this.invalidateSize,this)},_onMouseClick:function(b){if(!this.dragging||!this.dragging.moved()){this.fire("pre"+b.type),this._fireMouseEvent(b)}},_fireMouseEvent:function(c){var d=c.type,d=d=="mouseenter"?"mouseover":d=="mouseleave"?"mouseout":d;this.hasEventListeners(d)&&this.fire(d,{latlng:this.mouseEventToLatLng(c),layerPoint:this.mouseEventToLayerPoint(c)})},_initInteraction:function(){var c={dragging:L.Handler.MapDrag,touchZoom:L.Handler.TouchZoom,doubleClickZoom:L.Handler.DoubleClickZoom,scrollWheelZoom:L.Handler.ScrollWheelZoom,shiftDragZoom:L.Handler.ShiftDragZoom},d;for(d in c){c.hasOwnProperty(d)&&c[d]&&(this[d]=new c[d](this),this.options[d]&&this[d].enable())}},_onTileLayerLoad:function(){this._tileLayersToLoad--;if(this._tileLayersNum&&!this._tileLayersToLoad&&this._tileBg){clearTimeout(this._clearTileBgTimer),this._clearTileBgTimer=setTimeout(L.Util.bind(this._clearTileBg,this),500)}},_getTopLeftPoint:function(){if(!this._loaded){throw Error("Set map center and zoom first.")}return this._initialTopLeftPoint.subtract(L.DomUtil.getPosition(this._mapPane))},_getNewTopLeftPoint:function(c){var d=this.getSize().divideBy(2);return this.project(c).subtract(d).round()},_limitZoom:function(d){var e=this.getMinZoom(),f=this.getMaxZoom();return Math.max(e,Math.min(f,d))}});L.Map.include({locate:function(c){var d={timeout:10000};L.Util.extend(d,c);navigator.geolocation?navigator.geolocation.getCurrentPosition(L.Util.bind(this._handleGeolocationResponse,this),L.Util.bind(this._handleGeolocationError,this),d):this.fire("locationerror",{code:0,message:"Geolocation not supported."});return this},locateAndSetView:function(c,d){this._setViewOnLocate=!0;this._maxLocateZoom=c||Infinity;return this.locate(d)},_handleGeolocationError:function(c){var c=c.code,d=c==1?"permission denied":c==2?"position unavailable":"timeout";if(this._setViewOnLocate){this.fitWorld(),this._setViewOnLocate=!1}this.fire("locationerror",{code:c,message:"Geolocation error: "+d+"."})},_handleGeolocationResponse:function(g){var h=180*g.coords.accuracy/40000000,j=h*2,k=g.coords.latitude,l=g.coords.longitude,m=new L.LatLng(k-h,l-j),h=new L.LatLng(k+h,l+j),m=new L.LatLngBounds(m,h);if(this._setViewOnLocate){h=Math.min(this.getBoundsZoom(m),this._maxLocateZoom),this.setView(m.getCenter(),h),this._setViewOnLocate=!1}this.fire("locationfound",{latlng:new L.LatLng(k,l),bounds:m,accuracy:g.coords.accuracy})}});L.Map.include({openPopup:function(b){this.closePopup();this._popup=b;return this.addLayer(b)},closePopup:function(){this._popup&&this.removeLayer(this._popup);return this}});L.Map.include(!L.Transition||!L.Transition.implemented()?{}:{setView:function(e,f,g){var f=this._limitZoom(f),h=this._zoom!=f;if(this._loaded&&!g&&this._layers&&(g=this._getNewTopLeftPoint(e).subtract(this._getTopLeftPoint()),h?this._zoomToIfCenterInView&&this._zoomToIfCenterInView(e,f,g):this._panByIfClose(g))){return this}this._resetView(e,f);return this},panBy:function(b){if(!this._panTransition){this._panTransition=new L.Transition(this._mapPane,{duration:0.3}),this._panTransition.on("step",this._onPanTransitionStep,this),this._panTransition.on("end",this._onPanTransitionEnd,this)}this.fire(this,"movestart");this._panTransition.run({position:L.DomUtil.getPosition(this._mapPane).subtract(b)});return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){this.fire("moveend")},_panByIfClose:function(b){if(this._offsetIsWithinView(b)){return this.panBy(b),!0}return !1},_offsetIsWithinView:function(e,f){var g=f||1,h=this.getSize();return Math.abs(e.x)<=h.x*g&&Math.abs(e.y)<=h.y*g}});L.Map.include(!L.DomUtil.TRANSITION?{}:{_zoomToIfCenterInView:function(e,f,g){if(this._animatingZoom){return !0}if(!this.options.zoomAnimation){return !1}var h=Math.pow(2,f-this._zoom),g=g.divideBy(1-1/h);if(!this._offsetIsWithinView(g,1)){return !1}this._mapPane.className+=" leaflet-zoom-anim";g=this.containerPointToLayerPoint(this.getSize().divideBy(2)).add(g);this._prepareTileBg();this._runAnimation(e,f,h,g);return !0},_runAnimation:function(e,f,g,h){this._animatingZoom=!0;this._animateToCenter=e;this._animateToZoom=f;e=L.DomUtil.TRANSFORM;if(L.Browser.gecko||window.opera){this._tileBg.style[e]+=" translate(0,0)"}L.Browser.android?(this._tileBg.style[e+"Origin"]=h.x+"px "+h.y+"px",g="scale("+g+")"):g=L.DomUtil.getScaleString(g,h);L.Util.falseFn(this._tileBg.offsetWidth);h={};h[e]=this._tileBg.style[e]+" "+g;this._tileBg.transition.run(h)},_prepareTileBg:function(){if(!this._tileBg){this._tileBg=this._createPane("leaflet-tile-pane",this._mapPane),this._tileBg.style.zIndex=1}var c=this._tilePane,d=this._tileBg;d.style[L.DomUtil.TRANSFORM]="";d.style.visibility="hidden";d.empty=!0;c.empty=!1;this._tilePane=this._panes.tilePane=d;this._tileBg=c;if(!this._tileBg.transition){this._tileBg.transition=new L.Transition(this._tileBg,{duration:0.3,easing:"cubic-bezier(0.25,0.1,0.25,0.75)"}),this._tileBg.transition.on("end",this._onZoomTransitionEnd,this)}this._stopLoadingBgTiles()},_stopLoadingBgTiles:function(){for(var d=[].slice.call(this._tileBg.getElementsByTagName("img")),e=0,f=d.length;e<f;e++){d[e].complete||(d[e].parentNode.removeChild(d[e]),d[e]=null)}},_onZoomTransitionEnd:function(){this._restoreTileFront();L.Util.falseFn(this._tileBg.offsetWidth);this._resetView(this._animateToCenter,this._animateToZoom,!0);this._mapPane.className=this._mapPane.className.replace(" leaflet-zoom-anim","");this._animatingZoom=!1},_restoreTileFront:function(){this._tilePane.innerHTML="";this._tilePane.style.visibility="";this._tilePane.style.zIndex=2;this._tileBg.style.zIndex=1},_clearTileBg:function(){if(!this._animatingZoom&&!this.touchZoom._zooming){this._tileBg.innerHTML=""}}});L.Map.include({addControl:function(d){d.onAdd(this);var e=d.getPosition(),f=this._controlCorners[e],d=d.getContainer();L.DomUtil.addClass(d,"leaflet-control");e.indexOf("bottom")!=-1?f.insertBefore(d,f.firstChild):f.appendChild(d);return this},removeControl:function(d){var e=this._controlCorners[d.getPosition()],f=d.getContainer();e.removeChild(f);if(d.onRemove){d.onRemove(this)}return this},_initControlPos:function(){var c=this._controlCorners={},d=L.DomUtil.create("div","leaflet-control-container",this._container);L.Browser.touch&&(d.className+=" leaflet-big-buttons");c.topLeft=L.DomUtil.create("div","leaflet-top leaflet-left",d);c.topRight=L.DomUtil.create("div","leaflet-top leaflet-right",d);c.bottomLeft=L.DomUtil.create("div","leaflet-bottom leaflet-left",d);c.bottomRight=L.DomUtil.create("div","leaflet-bottom leaflet-right",d)}});var MicroEvent=function(){};MicroEvent.prototype={bind:function(a,b){this._events=this._events||{};this._events[a]=this._events[a]||[];this._events[a].push(b)},unbind:function(a,b){this._events=this._events||{};if(a in this._events===false){return}this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){this._events=this._events||{};if(a in this._events===false){return}for(var b=0;b<this._events[a].length;b++){this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}}};MicroEvent.mixin=function(a){var c=["bind","unbind","trigger"];for(var b=0;b<c.length;b++){a.prototype[c[b]]=MicroEvent.prototype[c[b]]}};if(typeof module!=="undefined"&&("exports" in module)){module.exports=MicroEvent}IoWrapper=function(){var a=this;this.realTimeHub=$.connection.realTimeHub;this.realTimeHub.gotMapExtent=function(b){console.log("IOWrapper: got updateMap...");a.trigger("updateMap",b)};this.realTimeHub.gotNewDamageLocation=function(b){console.log("IOWrapper: got PointAdded...");a.trigger("pointAdded",b)};$.connection.hub.start(function(){a.clientId=$.connection.hub.clientId;a.isConnected=true;a.realTimeHub.getMapPoints().done(function(b){$.each(b,function(c,d){a.trigger("pointAdded",d)})})});this.addMapPoint=function(b){if(this.isConnected){this.realTimeHub.addDamageLocation(b.lat,b.lng,b.pointType)}};this.pushMapState=function(b){if(this.isConnected){this.realTimeHub.updateMapExtent(b.lat,b.lng,b.zoom)}};this.getPoints=function(){if(this.isConnected){this.realTimeHub.getMapPoints().done(function(b){$.each(b,function(c,d){a.trigger("pointAdded",d)})})}}};MicroEvent.mixin(IOWrapper);if(!this.Map||typeof this.Map!=="object"){this.Map={}}Map.Controller=(function(a){var p={},n,f,l={},c={},m=false,e="",h,o=Map.Session;function k(){n=new L.Map("map");var r="http://{s}.tile.cloudmade.com/e157614f2e585e679ee4a14551192a57/997/256/{z}/{x}/{y}.png",q="Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade";f=new L.TileLayer(r,{maxZoom:18,attribution:q});var s=new L.LatLng(0,0);n.setView(s,4).addLayer(f);n.on("zoomend",function(u){if(m){console.log("zoomend: "+u.target.getCenter()+u.target.getZoom());var t=u.target.getCenter();l.pushMapState({lat:t.lat,lng:t.lng,zoom:u.target.getZoom()})}});n.on("dragend",function(u){if(m){console.log("dragend: "+u.target.getCenter()+u.target.getZoom());var t=u.target.getCenter();l.pushMapState({lat:t.lat,lng:t.lng,zoom:u.target.getZoom()})}})}function j(){l=new IoWrapper();l.getPoints();l.bind("updateMap",function(q){console.log("Got Update Map during init "+q.lat+" "+q.lng+" "+q.zoom);n.setView(new L.LatLng(q.lat,q.lng),q.zoom)});l.bind("pointAdded",d);l.bind("wii",function(q){console.log("Got wii:",q);var r=n.getSize().y/2;n.panBy(new L.Point(q.x*r,q.y*r))});l.bind("userCountUpdate",function(q){console.log("updating user count...",q);a("#userCount").text(" Current Users: "+q.count)})}function g(s){var r=h+s+".png",q=L.Icon.extend({iconSize:new L.Point(32,37),shadowSize:new L.Point(47,37),iconAnchor:new L.Point(13,35),shadowUrl:h+"custom-marker-shadow.png",iconUrl:r});return new q()}function d(q){n.addLayer(new L.Marker(new L.LatLng(q.lat,q.lng),{icon:g(q.pointType)}))}function b(r){var q={pointType:e,lat:r.latlng.lat,lng:r.latlng.lng};console.log("got a point...",q);l.addMapPoint(q);d(q);a("#message").text("");n.off("click",b)}p.setDriver=function(q){m=q};p.getMap=function(){return n};p.init=function(q){h=q.imageBaseUrl;k();j();a(".controls").on("click","#toggle-drive",function(){m=!m;var r=(m)?"Stop Driving":"Drive Map";a(this).toggleClass("ui-btn-active").text(r)});a("#drawing").on("click","li",function(r){e=a(this).data("type");a("#message").text("Click on map to set point location.");n.on("click",b)})};return p}($));